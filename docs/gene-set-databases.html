<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 3 Gene Set Databases | Gene Set Enrichment Analysis with R and Bioconductor</title>
<meta name="author" content="Zuguang Gu">
<meta name="generator" content="bookdown 0.32 with bs4_book()">
<meta property="og:title" content="Chapter 3 Gene Set Databases | Gene Set Enrichment Analysis with R and Bioconductor">
<meta property="og:type" content="book">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 3 Gene Set Databases | Gene Set Enrichment Analysis with R and Bioconductor">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.4.2/transition.js"></script><script src="libs/bs3compat-0.4.2/tabs.js"></script><script src="libs/bs3compat-0.4.2/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<link rel="stylesheet" href="style.css">
<meta name="description" content="3.1 Overview Gene set enrichment analysis evaluates the associations of a list of genes of interest to a collection of pre-defined gene sets, where each gene set represents a specific biological...">
<meta property="og:description" content="3.1 Overview Gene set enrichment analysis evaluates the associations of a list of genes of interest to a collection of pre-defined gene sets, where each gene set represents a specific biological...">
<meta name="twitter:description" content="3.1 Overview Gene set enrichment analysis evaluates the associations of a list of genes of interest to a collection of pre-defined gene sets, where each gene set represents a specific biological...">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Gene Set Enrichment Analysis with R and Bioconductor</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled"><li><a class="" href="index.html"><span class="header-section-number">Chapter 3</span> Gene Set Databases</a></li></ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/jokergoo/GSEA_book">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="gene-set-databases" class="section level1" number="3">
<h1>
<span class="header-section-number">3</span> Gene Set Databases<a class="anchor" aria-label="anchor" href="#gene-set-databases"><i class="fas fa-link"></i></a>
</h1>
<div id="overview" class="section level2" number="3.1">
<h2>
<span class="header-section-number">3.1</span> Overview<a class="anchor" aria-label="anchor" href="#overview"><i class="fas fa-link"></i></a>
</h2>
<p>Gene set enrichment analysis evaluates the associations of a list of genes of
interest to a collection of pre-defined gene sets, where each gene set
represents a specific biological function. Once genes are significantly
enriched in a gene set, the conclusion is made that the corresponding
biological function is significantly affected. Thus, choosing a proper
collection of gene sets focusing on specific topics is important for the
functional interpretations. The definition of a gene set is very flexible and
the construction of gene sets is straightforward. In most cases, gene sets are
from public databases where huge efforts from scientific curators have already
been made to carefully categorize genes into gene sets. Nevertheless, the gene
sets can also be self-defined from individual studies, such as a set of genes
in a network module from a co-expression network analysis, or a set of genes
that are up-regulated in a certain disease. In this chapter, I will introduce
several major gene set databases and I will demonstrate how to access the gene
set data in R.</p>
</div>
<div id="gene-ontology" class="section level2" number="3.2">
<h2>
<span class="header-section-number">3.2</span> Gene Ontology<a class="anchor" aria-label="anchor" href="#gene-ontology"><i class="fas fa-link"></i></a>
</h2>
<div id="the-go-database" class="section level3" number="3.2.1">
<h3>
<span class="header-section-number">3.2.1</span> The GO database<a class="anchor" aria-label="anchor" href="#the-go-database"><i class="fas fa-link"></i></a>
</h3>
<p>Gene Ontology (GO, <a href="http://geneontology.org/" class="uri">http://geneontology.org/</a>) is perhaps the most used gene set
database in current studies. The GO project was started in 1999. It aims to
construct biological functions in a well-organized form, which is both
effcient for human-reading and machine-reading. It also provides annotations
between biological terms and genes for a large number of
organisms, which gives a comprehensive knowledge for functional studies.</p>
<p>GO has three namespaces<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content="&lt;p&gt;Sometimes they are also called “domains” or
“ontologies” in current literatures.&lt;/p&gt;"><sup>1</sup></a>, which are biological process (BP),
cellular componet (CC) and molecular function (MF). They describe a gene or
its product protein from the three different aspects. Biological process
describes how a gene performs its functions in the biological system. Cellular
component describes the location in the cell where the gene performs its
function. Molecular function describes the molecular-level activity of a gene.
Under each namespace, GO terms are organized in a hierarchical way, in a form
of so-called directed acyclic graph (DAG). In this structure, a parent term
can have multiple child terms and a child term can have multiple parent terms,
but there is no loop. More on the top of the GO tree, more general the
corresponding term is.</p>
<div class="inline-figure"><img src="figures/GO_0044786.png" width="60%" style="display: block; margin: auto;"></div>
<p>GO is a structural representation of biological vocabularies, which itself is organism-independent.
However, the vocabulary is from the functional description of genes or proteins, thus, GO also
provides mappings between GO terms to genes. In current version (2022-07-01),
there are 43,558 GO terms, with more than 7 million annotations to more than
5000 organisms. This provides a powerful resouces for studying not only model
organisms, but a huge number of other organisms, which normally other gene set
databases do not support.</p>
<p>In many gene set enrichment anlaysis, GO gene sets are simply treated as lists
of genes. However, in some other analysis, the DAG structure of GO is also
taken into consideration, which helps to merge GO terms with similar
biological descritions, thus to reduce the redundancy of significant GO terms.</p>
<p>In Bioconductor, there are two categories of packages for GO data. The first
contains data only for the GO terms, i.e. their descriptions and relations.
The second category contains GO annotation to specific organisms. In the
following sections, I will demonstrate how to manipulate GO data and how to
extract GO gene sets for speicific organisms with Bioconductor packages.</p>
</div>
<div id="the-go.db-package" class="section level3" number="3.2.2">
<h3>
<span class="header-section-number">3.2.2</span> The <strong>GO.db</strong> package<a class="anchor" aria-label="anchor" href="#the-go.db-package"><i class="fas fa-link"></i></a>
</h3>
<p>The first package I will introduce is the <strong>GO.db</strong> package. It is maintained
by the Bioconductor core team and it is frequently updated in every
Bioconductor release. Thus, it always stores up-to-date data for GO and it can
be treated as the standard source to read and to process GO data in R. <strong>GO.db</strong>
contains detailed information of GO terms as well as the hierarchical
structure of the GO tree. The data in <strong>GO.db</strong> is only focused on GO terms
and their relations, and it is independent to specific organisms.</p>
<p>First let’s load the <strong>GO.db</strong> package.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">GO.db</span><span class="op">)</span></span></code></pre></div>
<div id="use-go.db-as-a-database-object" class="section level4" number="3.2.2.1">
<h4>
<span class="header-section-number">3.2.2.1</span> use <code>GO.db</code> as a database object<a class="anchor" aria-label="anchor" href="#use-go.db-as-a-database-object"><i class="fas fa-link"></i></a>
</h4>
<p><strong>GO.db</strong>, as its name tells, is a database package specifical for GO data.
Internally it is constructed by the low-level package <strong>AnnotationDbi</strong>, which
defines a general database interface for storing and precessing biological
annotation data. Internally the GO data is represented as an SQLite database
with multiple tables. A large number of low-level functions defined in
<strong>AnnotationDbi</strong> can be applied to the objects in <strong>GO.db</strong> to get customized
filtering on GO data. Expericenced readers may go to the documentation of
<strong>AnnotationDbi</strong> for more information.</p>
<p>There is an object <code>GO.db</code> which has the same name as the package.
Simply printing the object <code>GO.db</code> gives you the basic information of the package.
In the output, the two most important fields are the source file
(<code>GOSOURCEURL</code>) and the date (<code>GOSOURCEDATE</code>) to build the package, which
tells you the source and the version of the GO data.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">GO.db</span></span>
<span><span class="co"># GODb object:</span></span>
<span><span class="co"># | GOSOURCENAME: Gene Ontology</span></span>
<span><span class="co"># | GOSOURCEURL: http://current.geneontology.org/ontology/go-basic.obo</span></span>
<span><span class="co"># | GOSOURCEDATE: 2022-07-01</span></span>
<span><span class="co"># | Db type: GODb</span></span>
<span><span class="co"># | package: AnnotationDbi</span></span>
<span><span class="co"># | DBSCHEMA: GO_DB</span></span>
<span><span class="co"># | GOEGSOURCEDATE: 2022-Sep12</span></span>
<span><span class="co"># | GOEGSOURCENAME: Entrez Gene</span></span>
<span><span class="co"># | GOEGSOURCEURL: ftp://ftp.ncbi.nlm.nih.gov/gene/DATA</span></span>
<span><span class="co"># | DBSCHEMAVERSION: 2.1</span></span></code></pre></div>
<p><code>GO.db</code> is a database object created by <strong>AnnotationDbi</strong>, thus, the general
method <code><a href="https://rdrr.io/pkg/AnnotationDbi/man/AnnotationDb-class.html">select()</a></code> can be applied to retrieve the data by specifying a vector
of “keys” which is a list of GO IDs, and a group of “columns” which are the
fields where the values are retrieved. Just imagine the <code>GO.db</code> database as a
virtual table where there is a column for GO IDs which are used as primary
keys, and there are other columns of GO names, namespaces and long
descriptions. The <code><a href="https://rdrr.io/pkg/AnnotationDbi/man/AnnotationDb-class.html">select()</a></code> function gets corresponding values for these
columns by filtering with a specific set of GO IDs. In the following code, I
extract the values of the <code>"ONTOLOGY"</code> and <code>"TERM"</code> columns for two GO IDs.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/AnnotationDbi/man/AnnotationDb-class.html">select</a></span><span class="op">(</span><span class="va">GO.db</span>, keys <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"GO:0000001"</span>, <span class="st">"GO:0000002"</span><span class="op">)</span>, </span>
<span>    columns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ONTOLOGY"</span>, <span class="st">"TERM"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#         GOID ONTOLOGY                             TERM</span></span>
<span><span class="co"># 1 GO:0000001       BP        mitochondrion inheritance</span></span>
<span><span class="co"># 2 GO:0000002       BP mitochondrial genome maintenance</span></span></code></pre></div>
<p>You may wonder what are the valid names for the “columns” in this virtual table.
They can be obtained by <code>columns(GO.db)</code>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/AnnotationDbi/man/AnnotationDb-class.html">columns</a></span><span class="op">(</span><span class="va">GO.db</span><span class="op">)</span></span>
<span><span class="co"># [1] "DEFINITION" "GOID"       "ONTOLOGY"   "TERM"</span></span></code></pre></div>
<p><code>GOID</code> is the GO identifier, <code>ONTOLOGY</code> is the namespace of the GO term,
<code>TERM</code> is the short name of the GO term, and <code>DESCRIPTION</code> is the long
description of the GO term.</p>
</div>
<div id="objects-in-the-go.db-package" class="section level4" number="3.2.2.2">
<h4>
<span class="header-section-number">3.2.2.2</span> Objects in the <strong>GO.db</strong> package<a class="anchor" aria-label="anchor" href="#objects-in-the-go.db-package"><i class="fas fa-link"></i></a>
</h4>
<p><code><a href="https://rdrr.io/pkg/AnnotationDbi/man/AnnotationDb-class.html">select()</a></code> is a low-level function which can be used in any package that is
built with <strong>AnnotationDbi</strong>. However, specific for <strong>GO.db</strong>, we don’t really
need to use the low-level function <code><a href="https://rdrr.io/pkg/AnnotationDbi/man/AnnotationDb-class.html">select()</a></code> to retrieve the data. In
<strong>GO.db</strong>, there are several tables that have already been compiled and can be
used directly. These tables are represented as objects available in the
package. The following command prints all the objects that are exported from
<strong>GO.db</strong>. Note, in the interactive R terminal, users can also see the objects
by typing <code>GO.db::</code> and quickly clicking the tab-key twice<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content="&lt;p&gt;In Rstudio, the
list of objects automatically appears after typing &lt;code&gt;GO.db::&lt;/code&gt; in the R terminal
panel.&lt;/p&gt;"><sup>2</sup></a>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/AnnotationDbi/man/Bimap-envirAPI.html">ls</a></span><span class="op">(</span><span class="st">"package:GO.db"</span><span class="op">)</span></span>
<span><span class="co">#  [1] "GO"            "GO.db"         "GOBPANCESTOR"  "GOBPCHILDREN" </span></span>
<span><span class="co">#  [5] "GOBPOFFSPRING" "GOBPPARENTS"   "GOCCANCESTOR"  "GOCCCHILDREN" </span></span>
<span><span class="co">#  [9] "GOCCOFFSPRING" "GOCCPARENTS"   "GOMAPCOUNTS"   "GOMFANCESTOR" </span></span>
<span><span class="co"># [13] "GOMFCHILDREN"  "GOMFOFFSPRING" "GOMFPARENTS"   "GOOBSOLETE"   </span></span>
<span><span class="co"># [17] "GOSYNONYM"     "GOTERM"        "GO_dbInfo"     "GO_dbconn"    </span></span>
<span><span class="co"># [21] "GO_dbfile"     "GO_dbschema"</span></span></code></pre></div>
<p>Before I introduce the pre-compiled GO-related objects, I first briefly
introduce the following four function objects <code><a href="https://rdrr.io/pkg/GO.db/man/GO_dbconn.html">GO_dbInfo()</a></code>, <code><a href="https://rdrr.io/pkg/GO.db/man/GO_dbconn.html">GO_dbconn()</a></code>,
<code><a href="https://rdrr.io/pkg/GO.db/man/GO_dbconn.html">GO_dbfile()</a></code> and <code><a href="https://rdrr.io/pkg/GO.db/man/GO_dbconn.html">GO_dbschema()</a></code> in <strong>GO.db</strong>. These four functions can be
executed without argument. They provides information of the internal SQLite
database. For example, <code><a href="https://rdrr.io/pkg/GO.db/man/GO_dbconn.html">GO_dbfile()</a></code> returns the path of the database file.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/GO.db/man/GO_dbconn.html">GO_dbfile</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co"># [1] "/Users/guz/Library/R/x86_64/4.2/library/GO.db/extdata/GO.sqlite"</span></span></code></pre></div>
<p>If readers are interested, they can use external tools to view the <code>GO.sqlite</code>
file to see the internal representation of the database tables. However, for
other readers, the internal representation of data is less important.
<strong>GO.db</strong> provides an easy interface for processing the GO data, convert it
into data frames or lists.</p>
</div>
<div id="the-goterm-object" class="section level4" number="3.2.2.3">
<h4>
<span class="header-section-number">3.2.2.3</span> The <code>GOTERM</code> object<a class="anchor" aria-label="anchor" href="#the-goterm-object"><i class="fas fa-link"></i></a>
</h4>
<p>First let’s look at the variable <code>GOTERM</code>. It contains basic information of
every individual GO term, such as GO ID, the namespace and its definition. Let’s
directly print the <code>GOTERM</code> object.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">GOTERM</span></span>
<span><span class="co"># TERM map for GO (object of class "GOTermsAnnDbBimap")</span></span></code></pre></div>
<p>The output does not provide too much useful information. The only useful thing
is <code>GOTERM</code> is an object of class <code>GOTermsAnnDbBimap</code>. By querying the
documentation of <code>GOTermsAnnDbBimap</code><a class="footnote-ref" tabindex="0" data-toggle="popover" data-content="&lt;p&gt;With the command &lt;code&gt;?GOTermsAnnDbBimap&lt;/code&gt;&lt;/p&gt;"><sup>3</sup></a>,
we can find it is actually a child class of a more general class <code>Bimap</code>
defined in <code>AnnotationDbi</code>. The <code>Bimap</code> class is a low-level class defined for
mappings between two types of information. Thus, many low-level functions
defined in <strong>AnnotationDbi</strong> can be directly applied to <code>GOTERM</code> (see the
documentation of <code>Bimap</code>).</p>
<p>In the Bioconductor ecosystem, it is very often to see many different and
complex class definitions. Dont’ be panic of that. Many Bioconductor core and
extension packages are implemented in an object-oriented way. Therefore, it is
natural to have a large number class definitions to make the ecosystem
structural and easy to extend. However, as end-point users, you rarely need to
touch these classes directly. There are always easy and common ways to process
these complex Bioconductor objects.</p>
<p>As suggested in the documentation of <code>GOTERM</code><a class="footnote-ref" tabindex="0" data-toggle="popover" data-content="&lt;p&gt;You can see its documentation
by executing the command &lt;code&gt;?GOTERM&lt;/code&gt;.&lt;/p&gt;"><sup>4</sup></a>, we do not need to directly work with the
<code>GOTermsAnnDbBimap</code> class, instead we can just simply convert it to a list.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gl</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">as.list</a></span><span class="op">(</span><span class="va">GOTERM</span><span class="op">)</span></span></code></pre></div>
<p>Now <code>gl</code> is a normal list of GO terms. We can check the total number of GO
terms in current version of <strong>GO.db</strong><a class="footnote-ref" tabindex="0" data-toggle="popover" data-content="&lt;p&gt;Actually the number of all GO terms is
43558. Later in this section I will show you there is
an additional pseudo term in &lt;code&gt;GOTERM&lt;/code&gt;.)&lt;/p&gt;"><sup>5</sup></a>.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">gl</span><span class="op">)</span></span>
<span><span class="co"># [1] 43559</span></span></code></pre></div>
<p>We can get a single GO term by specifying the index.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">term</span> <span class="op">=</span> <span class="va">gl</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>  <span class="co">## also gl[["GO:0000001"]]</span></span>
<span><span class="va">term</span></span>
<span><span class="co"># GOID: GO:0000001</span></span>
<span><span class="co"># Term: mitochondrion inheritance</span></span>
<span><span class="co"># Ontology: BP</span></span>
<span><span class="co"># Definition: The distribution of mitochondria, including the</span></span>
<span><span class="co">#     mitochondrial genome, into daughter cells after mitosis or meiosis,</span></span>
<span><span class="co">#     mediated by interactions between mitochondria and the cytoskeleton.</span></span>
<span><span class="co"># Synonym: mitochondrial inheritance</span></span></code></pre></div>
<p>The output after printing <code>term</code> includes several fields and corresponding
values<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content="&lt;p&gt;You can try the command &lt;code&gt;str(term)&lt;/code&gt; to see its internal
representation.&lt;/p&gt;"><sup>6</sup></a>. Although <code>gl</code> is a normal list, its elements are still in a
special class <code>GOTerms</code>. Let’s check the class of <code>term</code>.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">term</span><span class="op">)</span></span>
<span><span class="co"># [1] "GOTerms"</span></span>
<span><span class="co"># attr(,"package")</span></span>
<span><span class="co"># [1] "AnnotationDbi"</span></span></code></pre></div>
<p>The object <code>term</code> is in a special class <code>GOTerms</code>. As I have explained, once
we have encounted a new class, we can always go to its documentation to see
its details. The <code>GOTerms</code> class is a simple class for storing information of
individual GO terms. There are several “getter” functions to extract values in
the corresponding fields. The most important functions are <code><a href="https://rdrr.io/pkg/AnnotationDbi/man/GOColsAndKeytypes.html">GOID()</a></code>, <code><a href="https://rdrr.io/pkg/AnnotationDbi/man/GOTerms-class.html">Term()</a></code>,
<code><a href="https://rdrr.io/pkg/BiocGenerics/man/Ontology.html">Ontology()</a></code>, and <code><a href="https://rdrr.io/pkg/AnnotationDbi/man/GOTerms-class.html">Definition()</a></code><a class="footnote-ref" tabindex="0" data-toggle="popover" data-content="&lt;p&gt;As you may have discovered, these functions
have the same names as the “fields.” This is a common design of Bioconductor
packages for the “getter functions.”&lt;/p&gt;"><sup>7</sup></a>. Other information on the <code>GOTerms</code>
function can be found from its documentation by <code><a href="https://rdrr.io/pkg/AnnotationDbi/man/GOTerms-class.html">?GOTerms</a></code>.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/AnnotationDbi/man/GOColsAndKeytypes.html">GOID</a></span><span class="op">(</span><span class="va">term</span><span class="op">)</span></span>
<span><span class="co"># [1] "GO:0000001"</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/AnnotationDbi/man/GOTerms-class.html">Term</a></span><span class="op">(</span><span class="va">term</span><span class="op">)</span></span>
<span><span class="co"># [1] "mitochondrion inheritance"</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/Ontology.html">Ontology</a></span><span class="op">(</span><span class="va">term</span><span class="op">)</span></span>
<span><span class="co"># [1] "BP"</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/AnnotationDbi/man/GOTerms-class.html">Definition</a></span><span class="op">(</span><span class="va">term</span><span class="op">)</span></span>
<span><span class="co"># [1] "The distribution of mitochondria, including the mitochondrial genome, into daughter cells after mitosis or meiosis, mediated by interactions between mitochondria and the cytoskeleton."</span></span></code></pre></div>
<p>Then, to get the namespaces of all GO terms, we can do apply <code>Oncology()</code>
function on every element in <code>gl</code>.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ol</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">gl</span>, <span class="va">Ontology</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">ol</span><span class="op">)</span></span>
<span><span class="co"># GO:0000001 GO:0000002 GO:0000003 GO:0000006 </span></span>
<span><span class="co">#       "BP"       "BP"       "BP"       "MF"</span></span></code></pre></div>
<p>The key feature of R programming language is vectorization. Besides working on
individual GO terms, the getter functions can be directly applied to the
global <code>GOTERM</code> object to extract information of all GO terms simultaneously.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/AnnotationDbi/man/GOColsAndKeytypes.html">GOID</a></span><span class="op">(</span><span class="va">GOTERM</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#   GO:0000001   GO:0000002   GO:0000003   GO:0000006 </span></span>
<span><span class="co"># "GO:0000001" "GO:0000002" "GO:0000003" "GO:0000006"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/Ontology.html">Ontology</a></span><span class="op">(</span><span class="va">GOTERM</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># GO:0000001 GO:0000002 GO:0000003 GO:0000006 </span></span>
<span><span class="co">#       "BP"       "BP"       "BP"       "MF"</span></span></code></pre></div>
<p>Now let’s go back to the object <code>GOTERM</code>. It stores data for all GO terms, so
essentially it is a list of elements in a certain format. <code>GOTERM</code> or its
class <code>GOTermsAnnDbBimap</code> allows subsetting to obtain a subset of GO terms.
There are two types of subset operators: single bracket <code>[</code> and double
brackets <code>[[</code>. They have different behaviors.</p>
<p>Similar as the subset operators for the normal list, the single bracket <code>[</code> returns a
subset of data but still keeps the original format. Both numeric and character
indices are allowed, but more often, character indices as GO IDs are used.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># note you can also use numeric indices like GOTERM[1:10]</span></span>
<span><span class="va">GOTERM</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"GO:0000001"</span>, <span class="st">"GO:0000002"</span>, <span class="st">"GO:0000003"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="co"># TERM submap for GO (object of class "GOTermsAnnDbBimap")</span></span></code></pre></div>
<p>So, if you want to get the namespaces of a subset of GO terms, you can do like:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">go_id</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"GO:0000001"</span>, <span class="st">"GO:0000002"</span>, <span class="st">"GO:0000003"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/Ontology.html">Ontology</a></span><span class="op">(</span><span class="va">GOTERM</span><span class="op">[</span><span class="va">go_id</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co"># GO:0000001 GO:0000002 GO:0000003 </span></span>
<span><span class="co">#       "BP"       "BP"       "BP"</span></span></code></pre></div>
<p>The double-bracket operator <code>[[</code> is different. It degenerates the original
format and directly extracts the element in it. Note here only a single
character index is allows:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># note numeric index is not allowed</span></span>
<span><span class="va">GOTERM</span><span class="op">[[</span><span class="st">"GO:0000001"</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co"># GOID: GO:0000001</span></span>
<span><span class="co"># Term: mitochondrion inheritance</span></span>
<span><span class="co"># Ontology: BP</span></span>
<span><span class="co"># Definition: The distribution of mitochondria, including the</span></span>
<span><span class="co">#     mitochondrial genome, into daughter cells after mitosis or meiosis,</span></span>
<span><span class="co">#     mediated by interactions between mitochondria and the cytoskeleton.</span></span>
<span><span class="co"># Synonym: mitochondrial inheritance</span></span></code></pre></div>
<p>This behaves the same as <code>gl[["GO::0000001"]]</code> but you don’t need to
explicitly convert <code>GOTERM</code> to the list in advance.</p>
<p>Above are the main functions for extracting inforamtion from the <code>GOTERM</code>
object. Now we can calculate some simple statistics on the GO terms. For
example, to calculate the number of terms, we can directly applying
<code><a href="https://rdrr.io/pkg/BiocGenerics/man/Ontology.html">Ontology()</a></code> on <code>GOTERM</code>.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/Ontology.html">Ontology</a></span><span class="op">(</span><span class="va">GOTERM</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># </span></span>
<span><span class="co">#        BP        CC        MF universal </span></span>
<span><span class="co">#     28140      4180     11238         1</span></span></code></pre></div>
<p>Interesting, besides the three namespaces <code>"BP"</code>, <code>"CC"</code> and <code>"MF"</code>, there
is an additional namespace <code>"universal"</code> that only contains one term. As
mentioned before, the three GO namespaces are isolateted. However, some tools
may require all GO terms are connected to form a connected
graph. Thus, one pseudo “universal root term” is added as the parent of root
nodes in the three namespaces. In <strong>GO.db</strong>, this special term has an ID
<code>"all"</code>.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/Ontology.html">Ontology</a></span><span class="op">(</span><span class="va">GOTERM</span><span class="op">)</span> <span class="op">==</span> <span class="st">"universal"</span><span class="op">)</span></span>
<span><span class="co">#   all </span></span>
<span><span class="co"># 43559</span></span>
<span><span class="va">GOTERM</span><span class="op">[[</span><span class="st">"all"</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co"># GOID: all</span></span>
<span><span class="co"># Term: all</span></span>
<span><span class="co"># Ontology: universal</span></span>
<span><span class="co"># Definition: NA</span></span></code></pre></div>
</div>
<div id="term-relations-in-go.db" class="section level4" number="3.2.2.4">
<h4>
<span class="header-section-number">3.2.2.4</span> Term relations in GO.db<a class="anchor" aria-label="anchor" href="#term-relations-in-go.db"><i class="fas fa-link"></i></a>
</h4>
<p><strong>GO.db</strong> also provides objects that contain relations between GO terms.
Taking biological process namespace as an example, there are the following
four objects (similar for other two namespaces, but with <code>GOCC</code> and <code>GOMF</code>
prefix).</p>
<ul>
<li><code>GOBPCHILDREN</code></li>
<li><code>GOBPPARENTS</code></li>
<li><code>GOBPOFFSPRING</code></li>
<li><code>GOBPANCESTOR</code></li>
</ul>
<p><code>GOBPCHILDREN</code> and <code>GOBPPARENTS</code> contain parent-child relations.
<code>GOBPOFFSPRING</code> contains all offspring terms of GO terms (i.e., all downstream
terms of a term in the GO tree) and <code>GOBPANCESTOR</code> contais all ancestor terms
of a GO term (i.e., all upstream terms of a term). The information in the four
objects are actually redudant, e.g., all the other three objects can be
constructed from <code>GOBPCHILDREN</code>. However, these pre-computated objects will
save time in downstream analysis because traversing the GO tree is
time-consuming.</p>
<p>The four objects are in the same format (objects of the <code>AnnDbBimap</code> class,
also inherts from the <code>Bimap</code> class). Taking <code>GOBPCHILDREN</code> as an example, as
its documentation suggests, we can directly convert it into a list.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lt</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">as.list</a></span><span class="op">(</span><span class="va">GOBPCHILDREN</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">lt</span><span class="op">)</span></span>
<span><span class="co"># $`GO:0000001`</span></span>
<span><span class="co"># [1] NA</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># $`GO:0000002`</span></span>
<span><span class="co">#      part of </span></span>
<span><span class="co"># "GO:0032042" </span></span>
<span><span class="co"># </span></span>
<span><span class="co"># $`GO:0000003`</span></span>
<span><span class="co">#          isa          isa      part of          isa          isa          isa </span></span>
<span><span class="co"># "GO:0019953" "GO:0019954" "GO:0022414" "GO:0032504" "GO:0032505" "GO:0075325" </span></span>
<span><span class="co">#          isa </span></span>
<span><span class="co"># "GO:1990277" </span></span>
<span><span class="co"># </span></span>
<span><span class="co"># $`GO:0000011`</span></span>
<span><span class="co"># [1] NA</span></span></code></pre></div>
<p>The variable <code>lt</code> is a simple list of vectors where each vector contains child
terms of a specific GO term, e.g., <code>GO:0000002</code> has a child term <code>GO:0032042</code>.
The element vectors in <code>lt</code> are also named and the names correspond to the
relations of the child terms to the parent term, i.e. <code>is-a</code> or
<code>part-of</code> relations. When the element vector has a value <code>NA</code>, e.g.
<code>GO::0000001</code>, this means the GO term is a leaf in the GO tree, and it has no
child term.</p>
<p>Some downstream analysis, e.g., network analysis, may expect the relations to
be represented as in two columns in a table. In this case, we can use the general
function <code><a href="https://rdrr.io/pkg/BiocGenerics/man/toTable.html">toTable()</a></code> defined in <strong>AnnotationDbi</strong> to convert <code>GOBPCHILDREN</code> to
a data frame<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content="&lt;p&gt;&lt;code&gt;toTable()&lt;/code&gt; can also be applied to &lt;code&gt;GOTERM&lt;/code&gt;. Readers can try to
see what is the output from &lt;code&gt;toTable(GOTERM)&lt;/code&gt;.&lt;/p&gt;"><sup>8</sup></a>.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tb</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/toTable.html">toTable</a></span><span class="op">(</span><span class="va">GOBPCHILDREN</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">tb</span><span class="op">)</span></span>
<span><span class="co">#        go_id      go_id RelationshipType</span></span>
<span><span class="co"># 1 GO:0032042 GO:0000002          part of</span></span>
<span><span class="co"># 2 GO:0019953 GO:0000003              isa</span></span>
<span><span class="co"># 3 GO:0019954 GO:0000003              isa</span></span>
<span><span class="co"># 4 GO:0022414 GO:0000003          part of</span></span></code></pre></div>
<p>Unfortunately, the first two columns in <code>tb</code> have the same name. A good idea
is to add meaningful column names to it. Users should carefully check which
column in the table contains parent terms and which column contains child
terms. After double checking with the output from the previous object <code>lt</code>, we
can be sure that the first column corresponds to child terms and the second
column corresponds to parent terms.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/row_colnames.html">colnames</a></span><span class="op">(</span><span class="va">tb</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"child"</span>, <span class="st">"parent"</span><span class="op">)</span></span></code></pre></div>
<p>With <code>tb</code>, we can calculate the fraction of different relations of GO terms.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tb</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/toTable.html">toTable</a></span><span class="op">(</span><span class="va">GOBPCHILDREN</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">tb</span><span class="op">[</span>, <span class="fl">3</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co"># </span></span>
<span><span class="co">#                  isa negatively regulates              part of </span></span>
<span><span class="co">#                51414                 2742                 5035 </span></span>
<span><span class="co"># positively regulates            regulates </span></span>
<span><span class="co">#                 2732                 3184</span></span></code></pre></div>
<p>The four objects also support the subset operator. E.g. to obtain all the
child terms of <code>GO:0000003</code>, you do not need to explicitely convert
<code>GOBPCHILDREN</code> to a list, but instead you can directly use <code>[[</code>:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">GOBPCHILDREN</span><span class="op">[[</span><span class="st">"GO:0000003"</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co">#          isa          isa      part of          isa          isa          isa </span></span>
<span><span class="co"># "GO:0019953" "GO:0019954" "GO:0022414" "GO:0032504" "GO:0032505" "GO:0075325" </span></span>
<span><span class="co">#          isa </span></span>
<span><span class="co"># "GO:1990277"</span></span></code></pre></div>
<p>We can also perform some exploratory analysis on the relations of GO terms.
The following code analyzed the distribution of the number of offspring terms.
The following plot shows it follows a power-law distribution.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lt</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">as.list</a></span><span class="op">(</span><span class="va">GOBPOFFSPRING</span><span class="op">)</span></span>
<span><span class="va">tb</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">lt</span>, <span class="va">length</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">x</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">tb</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">y</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html">as.vector</a></span><span class="op">(</span><span class="va">tb</span><span class="op">)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span><span class="op">(</span>trans<span class="op">=</span><span class="st">'log10'</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span>trans<span class="op">=</span><span class="st">'log10'</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Number of offspring terms (in log10 scale)"</span>, </span>
<span>         y <span class="op">=</span> <span class="st">"Counts (in log10 scale)"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"GOBPOFFSPRING"</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="02-database_files/figure-html/unnamed-chunk-26-1.png" width="672" style="display: block; margin: auto;"></div>
<p>We also visualize the distribution of the number of ancestor terms. This can
be approximated as a Possion distribution.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lt</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">as.list</a></span><span class="op">(</span><span class="va">GOBPANCESTOR</span><span class="op">)</span></span>
<span><span class="va">lt</span> <span class="op">=</span> <span class="va">lt</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">lt</span><span class="op">)</span> <span class="op">!=</span> <span class="st">"GO:0008150"</span><span class="op">]</span></span>
<span><span class="va">lt</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">lt</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/sets.html">setdiff</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"all"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">tb</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">lt</span>, <span class="va">length</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">x</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">tb</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">y</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html">as.vector</a></span><span class="op">(</span><span class="va">tb</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span>trans<span class="op">=</span><span class="st">'log10'</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Number of ancestor terms"</span>, </span>
<span>         y <span class="op">=</span> <span class="st">"Counts (in log10 scale)"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"GOBPANCESTOR"</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="02-database_files/figure-html/unnamed-chunk-27-1.png" width="672" style="display: block; margin: auto;"></div>
</div>
<div id="graph-analysis-of-go-tree" class="section level4" number="3.2.2.5">
<h4>
<span class="header-section-number">3.2.2.5</span> Graph analysis of GO tree<a class="anchor" aria-label="anchor" href="#graph-analysis-of-go-tree"><i class="fas fa-link"></i></a>
</h4>
<p>Relations in <code>GOBPCHILDREN</code> or <code>GOBPPARENTS</code> can be used to construct
the GO tree as a “graph” or a “netowrk” object. In this section, I will
demonstrate some exploratory analysis to show interesting attributes of
the GO from the aspect of being a graph.</p>
<p>Remember <code><a href="https://rdrr.io/pkg/BiocGenerics/man/toTable.html">toTable()</a></code> returns the relations between GO terms as a data frame,
thus, it can be used as “edge list” (or adjacency list) for constructing the
graph. In the following code, I use the <strong>igraph</strong> package for the graph
analysis. The function <code><a href="https://rdrr.io/pkg/igraph/man/graph_from_edgelist.html">graph.edgelist()</a></code> construct a graph object from a
two-column matrix where the first column is the source of the link (the parent
terms) and the second column is the target of the link (the child terms).</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://igraph.org">igraph</a></span><span class="op">)</span></span>
<span><span class="va">tb</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/toTable.html">toTable</a></span><span class="op">(</span><span class="va">GOBPCHILDREN</span><span class="op">)</span></span>
<span><span class="co"># It is very important to know in `tb` which column contains parent terms</span></span>
<span><span class="co"># and which column contains child terms</span></span>
<span><span class="va">g</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/igraph/man/graph_from_edgelist.html">graph.edgelist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="va">tb</span><span class="op">[</span>, <span class="fl">2</span><span class="op">:</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">g</span></span>
<span><span class="co"># IGRAPH 9af5911 DN-- 28140 65107 -- </span></span>
<span><span class="co"># + attr: name (v/c)</span></span>
<span><span class="co"># + edges from 9af5911 (vertex names):</span></span>
<span><span class="co">#  [1] GO:0000002-&gt;GO:0032042 GO:0000003-&gt;GO:0019953 GO:0000003-&gt;GO:0019954</span></span>
<span><span class="co">#  [4] GO:0000003-&gt;GO:0022414 GO:0000003-&gt;GO:0032504 GO:0000003-&gt;GO:0032505</span></span>
<span><span class="co">#  [7] GO:0000003-&gt;GO:0075325 GO:0000003-&gt;GO:1990277 GO:0000012-&gt;GO:1903516</span></span>
<span><span class="co"># [10] GO:0000012-&gt;GO:1903517 GO:0000012-&gt;GO:1903518 GO:0000012-&gt;GO:1903823</span></span>
<span><span class="co"># [13] GO:0000012-&gt;GO:1990396 GO:0000018-&gt;GO:0000019 GO:0000018-&gt;GO:0000337</span></span>
<span><span class="co"># [16] GO:0000018-&gt;GO:0010520 GO:0000018-&gt;GO:0010569 GO:0000018-&gt;GO:0045191</span></span>
<span><span class="co"># [19] GO:0000018-&gt;GO:0045910 GO:0000018-&gt;GO:0045911 GO:0000018-&gt;GO:0061806</span></span>
<span><span class="co"># [22] GO:0000018-&gt;GO:0072695 GO:0000018-&gt;GO:1903110 GO:0000019-&gt;GO:0032207</span></span>
<span><span class="co"># + ... omitted several edges</span></span></code></pre></div>
<p>The output shows the graph is directed, with 28140 nodes and 65107 edges. I
first extract GO term with the highest in-degree, where in-degree measures
number of nodes that point to a node, i.e. the number of parent terms.
In-degree is a local measurement and it can also be obtained from
<code>GOBPPARENTS</code>. In the following code, please note <code><a href="https://rdrr.io/pkg/BiocGenerics/man/which.min.html">which.max()</a></code> does not
ensure the returned index corresponds to the only maximal element. If there
are several elements having the same maximal value, <code><a href="https://rdrr.io/pkg/BiocGenerics/man/which.min.html">which.max()</a></code> only returns
the index of the first one.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">d</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/igraph/man/degree.html">degree</a></span><span class="op">(</span><span class="va">g</span>, mode <span class="op">=</span> <span class="st">"in"</span><span class="op">)</span></span>
<span><span class="va">d_in</span> <span class="op">=</span> <span class="va">d</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.min.html">which.max</a></span><span class="op">(</span><span class="va">d</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">d_in</span></span>
<span><span class="co"># GO:0106110 </span></span>
<span><span class="co">#         11</span></span>
<span><span class="co"># Numeric index is not allowd here, so we use the GO ID as the character index</span></span>
<span><span class="va">GOTERM</span><span class="op">[[</span><span class="st">"GO:0106110"</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co"># GOID: GO:0106110</span></span>
<span><span class="co"># Term: vomitoxin biosynthetic process</span></span>
<span><span class="co"># Ontology: BP</span></span>
<span><span class="co"># Definition: The chemical reactions and pathways resulting in the</span></span>
<span><span class="co">#     formation of type B trichothecene vomitoxin, also known as</span></span>
<span><span class="co">#     deoxynivalenol, a poisonous substance produced by some species of</span></span>
<span><span class="co">#     fungi and predominantly occurs in grains such as wheat, barley and</span></span>
<span><span class="co">#     oats.</span></span>
<span><span class="co"># Synonym: deoxynivalenol biosynthetic process</span></span>
<span><span class="co"># Synonym: DON biosynthetic process</span></span>
<span><span class="co"># Synonym: vomitoxin anabolism</span></span>
<span><span class="co"># Synonym: vomitoxin biosynthesis</span></span>
<span><span class="co"># Synonym: vomitoxin formation</span></span>
<span><span class="co"># Synonym: vomitoxin synthesis</span></span></code></pre></div>
<p>The result shows GO term <code>GO:0106110</code> has 11 parent terms<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content="&lt;p&gt;Think how can you
get the list of its 11 parent terms? Answer: &lt;code&gt;GOBPPARENTS[['GO:0106110']]&lt;/code&gt;&lt;/p&gt;"><sup>9</sup></a>.
Similarlly, we can calculate GO term with the highest out-degree, which
measures the number of child terms. Note this value can also be get from the
object <code>GOBPCHILDREN</code>.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">d</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/igraph/man/degree.html">degree</a></span><span class="op">(</span><span class="va">g</span>, mode <span class="op">=</span> <span class="st">"out"</span><span class="op">)</span></span>
<span><span class="va">d_out</span> <span class="op">=</span> <span class="va">d</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.min.html">which.max</a></span><span class="op">(</span><span class="va">d</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">d_out</span></span>
<span><span class="co"># GO:0048856 </span></span>
<span><span class="co">#        201</span></span>
<span><span class="va">GOTERM</span><span class="op">[[</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">d_out</span><span class="op">)</span> <span class="op">]</span><span class="op">]</span></span>
<span><span class="co"># GOID: GO:0048856</span></span>
<span><span class="co"># Term: anatomical structure development</span></span>
<span><span class="co"># Ontology: BP</span></span>
<span><span class="co"># Definition: The biological process whose specific outcome is the</span></span>
<span><span class="co">#     progression of an anatomical structure from an initial condition to</span></span>
<span><span class="co">#     its mature state. This process begins with the formation of the</span></span>
<span><span class="co">#     structure and ends with the mature structure, whatever form that</span></span>
<span><span class="co">#     may be including its natural destruction. An anatomical structure</span></span>
<span><span class="co">#     is any biological entity that occupies space and is distinguished</span></span>
<span><span class="co">#     from its surroundings. Anatomical structures can be macroscopic</span></span>
<span><span class="co">#     such as a carpel, or microscopic such as an acrosome.</span></span>
<span><span class="co"># Synonym: development of an anatomical structure</span></span></code></pre></div>
<p>Wow, this GO term <code>"GO:0048856"</code> has 201 child terms!</p>
<p>By using other functions in the <strong>igraph</strong> package, we can explore some
long-disatnce attributes of the GO tree, such as the distance from the root
term to every term in the namespace. The distance can be thought as the depth
of a term in the GO tree.</p>
<p>In the graph, the distance between two nodes is the length of the shortest
path between them in the graph. Since the GO tree is directed, the distance is
calculated with the path from a upstream node to a downstream term. In the
following code, we calculate the distance from the GO term <code>GO:0008150</code> which
is the root node “Biological Process” to all the terms in the BP namespace.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># based on the paths going out from GO:0008150</span></span>
<span><span class="va">dist</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/igraph/man/distances.html">distances</a></span><span class="op">(</span><span class="va">g</span>, v <span class="op">=</span> <span class="st">"GO:0008150"</span>, mode <span class="op">=</span> <span class="st">"out"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">dist</span><span class="op">)</span>, xlab <span class="op">=</span> <span class="st">"Depth"</span>, ylab <span class="op">=</span> <span class="st">"Count"</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="02-database_files/figure-html/unnamed-chunk-31-1.png" width="672" style="display: block; margin: auto;"></div>
<p>The plot shows around 95% of the terms having depth between 3 to 7. We also
find there are several GO terms that locate extremely deep in the GO tree with
depth of 11. We can also try to extract the longest path from the root term to
the leaf terms.</p>
<p>In the following code, I first extract a vector of leaf terms. Leaf terms locate
at the end of the GO tree with zero out-degree.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">d</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/igraph/man/degree.html">degree</a></span><span class="op">(</span><span class="va">g</span>, mode <span class="op">=</span> <span class="st">"out"</span><span class="op">)</span></span>
<span><span class="va">leave</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">d</span><span class="op">[</span><span class="va">d</span> <span class="op">==</span> <span class="fl">0</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p>Similar to <code>distance()</code>, here we use the function <code><a href="https://rdrr.io/pkg/igraph/man/distances.html">shortest_paths()</a></code> which
returns a list of shortest paths from “<a href="GO:0008150" class="uri">GO:0008150</a>” to each of the leaf node. The object
<code>sp</code> contains the complete result from the shortest path analysis. Here we
only need its <code>vpath</code> element which contains the paths information.
Variable <code>i</code> contains the index of the leaf node which has the largest
distance to the root node<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content="&lt;p&gt;Again note, if there are several leaf nodes having
the same max distance, &lt;code&gt;which.max()&lt;/code&gt; only returns the first one.&lt;/p&gt;"><sup>10</sup></a>. Object <code>path</code>
contains the longest shortest path from “<a href="GO:0008150" class="uri">GO:0008150</a>” to the leaf node,</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sp</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/igraph/man/distances.html">shortest_paths</a></span><span class="op">(</span><span class="va">g</span>, from <span class="op">=</span> <span class="st">"GO:0008150"</span>, to <span class="op">=</span> <span class="va">leave</span>, mode <span class="op">=</span> <span class="st">"out"</span><span class="op">)</span></span>
<span><span class="va">i</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/which.min.html">which.max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">sp</span><span class="op">$</span><span class="va">vpath</span>, <span class="va">length</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">path</span> <span class="op">=</span> <span class="va">sp</span><span class="op">$</span><span class="va">vpath</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">path</span></span>
<span><span class="co"># + 12/28140 vertices, named, from 9af5911:</span></span>
<span><span class="co">#  [1] GO:0008150 GO:0008152 GO:0006807 GO:0051173 GO:0051247 GO:0045862</span></span>
<span><span class="co">#  [7] GO:0010952 GO:0010950 GO:2001056 GO:0043280 GO:0006919 GO:0008635</span></span></code></pre></div>
<p><code>sp</code> is in a special data format, we can use the function <code><a href="https://rdrr.io/r/base/names.html">names()</a></code> to obtain the vector
of GO IDs. Finally, we subset the object <code>GOTERM</code> and apply <code><a href="https://rdrr.io/pkg/AnnotationDbi/man/GOTerms-class.html">Term()</a></code>
to obtain the names of GO IDs in this longest path.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/AnnotationDbi/man/GOTerms-class.html">Term</a></span><span class="op">(</span><span class="va">GOTERM</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">path</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#                                                                                         GO:0008150 </span></span>
<span><span class="co">#                                                                               "biological_process" </span></span>
<span><span class="co">#                                                                                         GO:0008152 </span></span>
<span><span class="co">#                                                                                "metabolic process" </span></span>
<span><span class="co">#                                                                                         GO:0006807 </span></span>
<span><span class="co">#                                                              "nitrogen compound metabolic process" </span></span>
<span><span class="co">#                                                                                         GO:0051173 </span></span>
<span><span class="co">#                                       "positive regulation of nitrogen compound metabolic process" </span></span>
<span><span class="co">#                                                                                         GO:0051247 </span></span>
<span><span class="co">#                                                 "positive regulation of protein metabolic process" </span></span>
<span><span class="co">#                                                                                         GO:0045862 </span></span>
<span><span class="co">#                                                               "positive regulation of proteolysis" </span></span>
<span><span class="co">#                                                                                         GO:0010952 </span></span>
<span><span class="co">#                                                        "positive regulation of peptidase activity" </span></span>
<span><span class="co">#                                                                                         GO:0010950 </span></span>
<span><span class="co">#                                                    "positive regulation of endopeptidase activity" </span></span>
<span><span class="co">#                                                                                         GO:2001056 </span></span>
<span><span class="co">#                                      "positive regulation of cysteine-type endopeptidase activity" </span></span>
<span><span class="co">#                                                                                         GO:0043280 </span></span>
<span><span class="co">#        "positive regulation of cysteine-type endopeptidase activity involved in apoptotic process" </span></span>
<span><span class="co">#                                                                                         GO:0006919 </span></span>
<span><span class="co">#                 "activation of cysteine-type endopeptidase activity involved in apoptotic process" </span></span>
<span><span class="co">#                                                                                         GO:0008635 </span></span>
<span><span class="co"># "activation of cysteine-type endopeptidase activity involved in apoptotic process by cytochrome c"</span></span></code></pre></div>
</div>
</div>
<div id="link-go-terms-to-genes" class="section level3" number="3.2.3">
<h3>
<span class="header-section-number">3.2.3</span> Link GO terms to genes<a class="anchor" aria-label="anchor" href="#link-go-terms-to-genes"><i class="fas fa-link"></i></a>
</h3>
<p>As introduced in the previous section, <strong>GO.db</strong> only provides data solely for
GO terms, and there is no organism-specific information. Since GO volcabulary
is mainly collected from gene function descriptions, the GO project also
provides gene annotations to GO terms. The annotation is done by manual
curation or by computational prediction. Such annotations are represented as
mappings between GO IDs and various gene IDs from external databases, which
are usually synchronized between major public databases such as NCBI and
Ensembl.</p>
<p>In Bioconductor, there are a group of standard packages with the name
convension <strong>org.*.db</strong> which contain various database ID mappings for a
specific organism. In this section, I will demonstrate how to get gene-GO
mappings from these packages. Currently there are the following organisms
supported:</p>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th align="left">Package</th>
<th align="left">Organism</th>
<th align="left">Package</th>
<th align="left">Organism</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left"><code>org.Hs.eg.db</code></td>
<td align="left">Human</td>
<td align="left"><code>org.Ss.eg.db</code></td>
<td align="left">Pig</td>
</tr>
<tr class="even">
<td align="left"><code>org.Mm.eg.db</code></td>
<td align="left">Mouse</td>
<td align="left"><code>org.Gg.eg.db</code></td>
<td align="left">Chicken</td>
</tr>
<tr class="odd">
<td align="left"><code>org.Rn.eg.db</code></td>
<td align="left">Rat</td>
<td align="left"><code>org.Mmu.eg.db</code></td>
<td align="left">Rhesus monkey</td>
</tr>
<tr class="even">
<td align="left"><code>org.Dm.eg.db</code></td>
<td align="left">Fruit fly</td>
<td align="left"><code>org.Cf.eg.db</code></td>
<td align="left">Canine</td>
</tr>
<tr class="odd">
<td align="left"><code>org.At.tair.db</code></td>
<td align="left">Arabidopsis</td>
<td align="left"><code>org.EcK12.eg.db</code></td>
<td align="left">E coli strain K12</td>
</tr>
<tr class="even">
<td align="left"><code>org.Sc.sgd.db</code></td>
<td align="left">Yeast</td>
<td align="left"><code>org.Xl.eg.db</code></td>
<td align="left">African clawed frog</td>
</tr>
<tr class="odd">
<td align="left"><code>org.Dr.eg.db</code></td>
<td align="left">Zebrafish</td>
<td align="left"><code>org.Ag.eg.db</code></td>
<td align="left">Malaria mosquito</td>
</tr>
<tr class="even">
<td align="left"><code>org.Ce.eg.db</code></td>
<td align="left">Nematode</td>
<td align="left"><code>org.Pt.eg.db</code></td>
<td align="left">Chimpanzee</td>
</tr>
<tr class="odd">
<td align="left"><code>org.Bt.eg.db</code></td>
<td align="left">Bovine</td>
<td align="left"><code>org.EcSakai.eg.db</code></td>
<td align="left">E coli strain Sakai</td>
</tr>
</tbody>
</table></div>
<p>In the next section, I will take <strong>org.Hs.eg.db</strong> as an example. The use for
other organism packages is completely the same.</p>
<div id="the-org.hs.eg.db-package" class="section level4" number="3.2.3.1">
<h4>
<span class="header-section-number">3.2.3.1</span> The <strong>org.Hs.eg.db</strong> package<a class="anchor" aria-label="anchor" href="#the-org.hs.eg.db-package"><i class="fas fa-link"></i></a>
</h4>
<p>The <strong>org.Hs.eg.db</strong> package provides a standard way for mappings from Entrez
gene IDs to a variaty of other databases for human. First let’s load the
package.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">org.Hs.eg.db</span><span class="op">)</span></span></code></pre></div>
<p><strong>org.Hs.eg.db</strong> is also built by <strong>AnnotationDbi</strong>, thus low-level functions
such as <code><a href="https://rdrr.io/pkg/AnnotationDbi/man/AnnotationDb-class.html">select()</a></code> can be applied to get information from the database.
Similar to <strong>GO.db</strong>, there is also an object <code>org.Hs.eg.db</code> with the same
name as the package, which is the database object for the use with <code><a href="https://rdrr.io/pkg/AnnotationDbi/man/AnnotationDb-class.html">select()</a></code>.
I will introduce how to use <code><a href="https://rdrr.io/pkg/AnnotationDbi/man/AnnotationDb-class.html">select()</a></code> on <code>org.Hs.eg.db</code> later in the next
section, because in <strong>org.Hs.eg.db</strong>, there is more convinient way to retrieve
GO-gene mappings.</p>
<p>Similar to <strong>GO.db</strong>, there are also many pre-compiled objects in the
package<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;A full list of objects can be obtained by &lt;code&gt;ls("package:org.Hs.eg.db&lt;/code&gt;.
I will introduce some of the other objects later when introducing converting
different gene ID types.&lt;/p&gt;'><sup>11</sup></a>. Among them, there are the following two objects for
mapping between GO IDs and genes:</p>
<ul>
<li><code>org.Hs.egGO2EG</code></li>
<li><code>org.Hs.egGO2ALLEGS</code></li>
</ul>
<p>The difference between the two objects is <code>org.Hs.egGO2EG</code> contains genes that
are <em>directly annotated</em> to every GO term, while <code>org.Hs.egGO2ALLEGS</code> contains
genes that directly assigned to the GO term, <em>as well as genes assigned to all
its ancestor terms</em>. For example if term A is a parent of term B where A is
more general, genes with function B should also have function A. Thus
<code>org.Hs.egGO2ALLEGS</code> is the proper object for GO gene
sets<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content="&lt;p&gt;&lt;code&gt;org.Hs.egGO2ALLEGS&lt;/code&gt; actually can be generated from &lt;code&gt;org.Hs.egGO2EG&lt;/code&gt; and
&lt;code&gt;GOBPANCESTOR&lt;/code&gt; (if only looking at BP namespace). Think how to implement the
code.&lt;/p&gt;"><sup>12</sup></a>.</p>
<p>Again, <code>org.Hs.egGO2ALLEGS</code> is a database object in a special format
<code>Go3AnnDbBimap</code>. We do not need to directly work with this class. There are
two ways to obtain gene annotations to GO terms. The first is to convert
<code>org.Hs.egGO2ALLEGS</code> to a list of gene vectors.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lt</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">as.list</a></span><span class="op">(</span><span class="va">org.Hs.egGO2ALLEGS</span><span class="op">)</span></span>
<span> <span class="co"># lt[[2]] is too long to print, so we orint the third and the fourth</span></span>
<span><span class="va">lt</span><span class="op">[</span><span class="fl">3</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span></span>
<span><span class="co"># $`GO:0000012`</span></span>
<span><span class="co">#         IGI         IDA         IDA         IDA         NAS         IDA </span></span>
<span><span class="co">#       "142"      "1161"      "2074"      "3981"      "7014"      "7141" </span></span>
<span><span class="co">#         IEA         IGI         IMP         IMP         IBA         IDA </span></span>
<span><span class="co">#      "7515"      "7515"      "7515"     "23411"     "54840"     "54840" </span></span>
<span><span class="co">#         IBA         IDA         IMP         IMP         IEA </span></span>
<span><span class="co">#     "55775"     "55775"     "55775"    "200558" "100133315" </span></span>
<span><span class="co"># </span></span>
<span><span class="co"># $`GO:0000017`</span></span>
<span><span class="co">#    IDA    IMP    ISS    IDA </span></span>
<span><span class="co"># "6523" "6523" "6523" "6524"</span></span></code></pre></div>
<p>In <code>lt</code>, each element vector actually is a GO gene set. Note here the genes
are in digital Entrez IDs but represented in character mode. This is
important to save the Gene IDs explicitly as characters to get rid of
potential error due to indexing. We will emphasize it again in later text.</p>
<p>The gene ID vector have names. They are evidence codes of assigning genes to
GO terms.</p>
<p><code>org.Hs.egGO2ALLEGS</code> is a database object (also inherts from the <code>Bimap</code>
class), thus <code><a href="https://rdrr.io/pkg/BiocGenerics/man/toTable.html">toTable()</a></code> can be directly applied to convert it as a table.</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tb</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/toTable.html">toTable</a></span><span class="op">(</span><span class="va">org.Hs.egGO2ALLEGS</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">tb</span><span class="op">)</span></span>
<span><span class="co">#   gene_id      go_id Evidence Ontology</span></span>
<span><span class="co"># 1       1 GO:0008150       ND       BP</span></span>
<span><span class="co"># 2       2 GO:0000003      IEA       BP</span></span>
<span><span class="co"># 3       2 GO:0001553      IEA       BP</span></span>
<span><span class="co"># 4       2 GO:0001867      IDA       BP</span></span></code></pre></div>
<p>Now there is an additional column <code>"Ontology"</code>. This is convinient for
subsetting <code>tb</code> to a certain GO namespace. <code>org.Hs.egGO2ALLEGS</code> contains GO
terms from the three namespaces and the <code><a href="https://rdrr.io/r/base/list.html">as.list()</a></code> method cannot distinguish
the different namespaces. To restrict <code>lt</code> only to BP GO terms, extra steps
need to be applied with the object <code>GOTERM</code> and the function <code><a href="https://rdrr.io/pkg/BiocGenerics/man/Ontology.html">Ontology()</a></code>.
Also note in <code>tb</code>, the first column <code>gene_id</code> is in “character” mode.</p>
<p>With <code>tb</code>, we can look at the distribution of number of genes in GO gene sets.
The following plot shows it approximately follows a power-law distribution.</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tb</span> <span class="op">=</span> <span class="va">tb</span><span class="op">[</span><span class="va">tb</span><span class="op">$</span><span class="va">Ontology</span> <span class="op">==</span> <span class="st">"BP"</span>, <span class="op">]</span></span>
<span><span class="va">t1</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">tb</span><span class="op">$</span><span class="va">go_id</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">x1</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">t1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">y1</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html">as.vector</a></span><span class="op">(</span><span class="va">t1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x1</span>, y <span class="op">=</span> <span class="va">y1</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span><span class="op">(</span>trans<span class="op">=</span><span class="st">'log10'</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span>trans<span class="op">=</span><span class="st">'log10'</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Number of annotated genes (in log10 scale)"</span>, </span>
<span>         y <span class="op">=</span> <span class="st">"Counts (in log10 scale)"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"GOBP"</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="02-database_files/figure-html/unnamed-chunk-40-1.png" width="672" style="display: block; margin: auto;"></div>
<p>And the distribution of number of GO gene sets that a gene is in. This appriximately</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">t2</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">tb</span><span class="op">$</span><span class="va">gene_id</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">x2</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">t2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">y2</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html">as.vector</a></span><span class="op">(</span><span class="va">t2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x2</span>, y <span class="op">=</span> <span class="va">y2</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_continuous</a></span><span class="op">(</span>trans<span class="op">=</span><span class="st">'log10'</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span>trans<span class="op">=</span><span class="st">'log10'</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Number of gene sets (in log10 scale)"</span>, </span>
<span>         y <span class="op">=</span> <span class="st">"Counts (in log10 scale)"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"GOBP"</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="02-database_files/figure-html/unnamed-chunk-41-1.png" width="672" style="display: block; margin: auto;"></div>
</div>
<div id="orgdb-objects-for-other-organisms" class="section level4" number="3.2.3.2">
<h4>
<span class="header-section-number">3.2.3.2</span> OrgDb objects for other organisms<a class="anchor" aria-label="anchor" href="#orgdb-objects-for-other-organisms"><i class="fas fa-link"></i></a>
</h4>
<p>There are only a few organism packages available on Bioconductor. Massive more
organisms are available on the official Bioconductor cloud and they can be
accessed with the <strong>AnnotationHub</strong> package. <strong>AnnotationHub</strong> not only hosts
<code>OrgDb</code> objects but also a wide range of other genomic annotation datasets. In
this section, I will demonstrate how to query and obtain the <code>OrgDb</code> object
for a non-model organism.</p>
<p>To use <strong>AnnotationHub</strong>, the first step is to create a new <code>AnnotationHub</code>
instance. In this step, a local cache folder is created so that the same data
will be directly read from cache and will not be repeatedly downloaded from
remote cloud server.</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">AnnotationHub</span><span class="op">)</span></span>
<span><span class="co"># If it is the first time, it may take several seconds</span></span>
<span><span class="va">ah</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/AnnotationHub/man/AnnotationHub-class.html">AnnotationHub</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>The next step is to look for a the <code>OrgDb</code> object for a specific organism.
Here I take the dolphin as an example. When using <strong>AnnotationHub</strong>, it is
more suggested to use the organism’s Latin name, because it is always ensured
that Latin names are stored in the hub database while sometimes it is
difficult to find the correct results if using the common names<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content="&lt;p&gt;Readers can
try to run the example query but with “dolphine” as the query strings.&lt;/p&gt;"><sup>13</sup></a>. To
look for the <code>OrgDb</code> object for dolphin, I provide both organism name
(“Tursiops truncatus”) and the data class (“OrgDb”) as the query keywords in
the function <code><a href="https://rdrr.io/pkg/AnnotationHub/man/AnnotationHub-class.html">query()</a></code>.</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/AnnotationHub/man/AnnotationHub-class.html">query</a></span><span class="op">(</span><span class="va">ah</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Tursiops truncatus"</span>, <span class="st">"OrgDb"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># AnnotationHub with 1 record</span></span>
<span><span class="co"># # snapshotDate(): 2022-10-31</span></span>
<span><span class="co"># # names(): AH108106</span></span>
<span><span class="co"># # $dataprovider: ftp://ftp.ncbi.nlm.nih.gov/gene/DATA/</span></span>
<span><span class="co"># # $species: Tursiops truncatus</span></span>
<span><span class="co"># # $rdataclass: OrgDb</span></span>
<span><span class="co"># # $rdatadateadded: 2022-10-26</span></span>
<span><span class="co"># # $title: org.Tursiops_truncatus.eg.sqlite</span></span>
<span><span class="co"># # $description: NCBI gene ID based annotations about Tursiops truncatus</span></span>
<span><span class="co"># # $taxonomyid: 9739</span></span>
<span><span class="co"># # $genome: NCBI genomes</span></span>
<span><span class="co"># # $sourcetype: NCBI/UniProt</span></span>
<span><span class="co"># # $sourceurl: ftp://ftp.ncbi.nlm.nih.gov/gene/DATA/, ftp://ftp.uniprot.org/p...</span></span>
<span><span class="co"># # $sourcesize: NA</span></span>
<span><span class="co"># # $tags: c("NCBI", "Gene", "Annotation") </span></span>
<span><span class="co"># # retrieve record with 'object[["AH108106"]]'</span></span></code></pre></div>
<p>The output shows there is exactly one hit after the query. After reading the
output, we are pretty sure this is the correct result we are looking for. In
the output, we need the ID “AH108106” to finally extract the <code>OrgDb</code> object.</p>
<p>In the previous example, in <code><a href="https://rdrr.io/pkg/AnnotationHub/man/AnnotationHub-class.html">query()</a></code>, I searched both the organism name and
the data type. We can also first restrict <code>ah</code> only in the <code>OrgDb</code> data types
before query.</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ah</span> <span class="op">=</span> <span class="va">ah</span><span class="op">[</span><span class="va">ah</span><span class="op">$</span><span class="va">rdataclass</span> <span class="op">==</span> <span class="st">"OrgDb"</span><span class="op">]</span> <span class="co"># pre-filtering</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/AnnotationHub/man/AnnotationHub-class.html">query</a></span><span class="op">(</span><span class="va">ah</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Tursiops truncatus"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>In this example, we are lucky because <code><a href="https://rdrr.io/pkg/AnnotationHub/man/AnnotationHub-class.html">query()</a></code> returns one single hit.
Actually in many other circustances, <code><a href="https://rdrr.io/pkg/AnnotationHub/man/AnnotationHub-class.html">query()</a></code> may return more than one hits,
which makes it difficult to find the correct one. Luckily, <strong>AnnotationHub</strong>
provides a <code><a href="https://rdrr.io/pkg/interactiveDisplayBase/man/interactiveDisplayBase-methods.html">display()</a></code> function which will create a master table in a web page
that allows you to select it interactively<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content="&lt;p&gt;The use of the interactive table
is very straightforward. I encourage readers to run the code and try to filter
the table by themselves.&lt;/p&gt;"><sup>14</sup></a>.</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/interactiveDisplayBase/man/interactiveDisplayBase-methods.html">display</a></span><span class="op">(</span><span class="va">ah</span><span class="op">)</span></span></code></pre></div>
<p>Now with the hub ID “AH108106,” we can download the <code>OrgDb</code> object from
Biocoductor cloud by specifying the ID as an index of <code>ah</code>. The dataset will
be downloaded and cached locally. Let’s print the <code>org</code> object.</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># try to run this line twice</span></span>
<span><span class="va">org</span> <span class="op">=</span> <span class="va">ah</span><span class="op">[[</span><span class="st">"AH108106"</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">org</span></span>
<span><span class="co"># OrgDb object:</span></span>
<span><span class="co"># | DBSCHEMAVERSION: 2.1</span></span>
<span><span class="co"># | DBSCHEMA: NOSCHEMA_DB</span></span>
<span><span class="co"># | ORGANISM: Tursiops truncatus</span></span>
<span><span class="co"># | SPECIES: Tursiops truncatus</span></span>
<span><span class="co"># | CENTRALID: GID</span></span>
<span><span class="co"># | Taxonomy ID: 9739</span></span>
<span><span class="co"># | Db type: OrgDb</span></span>
<span><span class="co"># | Supporting package: AnnotationDbi</span></span></code></pre></div>
<p>As I have already introduced in previous sections, the Bioconductor organism
packages also contain pre-compiled objects which facilitate the use. However,
the object retrieved from AnnotationHus is in the “raw” <code>OrgDb</code> class, which we
need to use the low-level <code><a href="https://rdrr.io/pkg/AnnotationDbi/man/AnnotationDb-class.html">select()</a></code> function to obtain data from this database
object.</p>
<p>The <code>OrgDb</code> object contains ID mappings for various databases. Just imagine it
is a huge table. The function <code><a href="https://rdrr.io/pkg/AnnotationDbi/man/AnnotationDb-class.html">columns()</a></code> returns all columns that can be
queried. In this table, not all columns can be primariy query keys,
<code><a href="https://rdrr.io/pkg/AnnotationDbi/man/AnnotationDb-class.html">keytypes()</a></code> returns a subset of columns that can be the primariy keys<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content="&lt;p&gt;If you
compare the two results, it is obvious that &lt;code&gt;CHR&lt;/code&gt; is not a proper candidate to
be primary keys.&lt;/p&gt;"><sup>15</sup></a>.</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/AnnotationDbi/man/AnnotationDb-class.html">columns</a></span><span class="op">(</span><span class="va">org</span><span class="op">)</span></span>
<span><span class="co">#  [1] "ACCNUM"      "ALIAS"       "CHR"         "ENSEMBL"     "ENTREZID"   </span></span>
<span><span class="co">#  [6] "EVIDENCE"    "EVIDENCEALL" "GENENAME"    "GID"         "GO"         </span></span>
<span><span class="co"># [11] "GOALL"       "ONTOLOGY"    "ONTOLOGYALL" "PMID"        "REFSEQ"     </span></span>
<span><span class="co"># [16] "SYMBOL"</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/AnnotationDbi/man/AnnotationDb-class.html">keytypes</a></span><span class="op">(</span><span class="va">org</span><span class="op">)</span></span>
<span><span class="co">#  [1] "ACCNUM"      "ALIAS"       "ENSEMBL"     "ENTREZID"    "EVIDENCE"   </span></span>
<span><span class="co">#  [6] "EVIDENCEALL" "GENENAME"    "GID"         "GO"          "GOALL"      </span></span>
<span><span class="co"># [11] "ONTOLOGY"    "ONTOLOGYALL" "PMID"        "REFSEQ"      "SYMBOL"</span></span></code></pre></div>
<p>To get the the mapping between gene ID and GO ID, first we need to obtain a
vector of all genes in Entrez IDs. This is done by calling <code><a href="https://rdrr.io/pkg/AnnotationDbi/man/AnnotationDb-class.html">keys()</a></code> with
specifying the <code>keytypye</code> argument. There is always a default keytype, but it
is a good idea to explicitly to specify it.</p>
<p>Now we can use the <code><a href="https://rdrr.io/pkg/AnnotationDbi/man/AnnotationDb-class.html">select()</a></code> function to find GO IDs mapping to evey gene
with Entrez ID. Since this is a mapping between two types of IDs, it is enough
to<code>columns</code> to a single column value which is <code>GOALL</code><a class="footnote-ref" tabindex="0" data-toggle="popover" data-content="&lt;p&gt;For a GO term, &lt;code&gt;GOALL&lt;/code&gt;
include genes for all its offspring terms.&lt;/p&gt;"><sup>16</sup></a>. Remember again we need to set
<code>keytype</code> argument to <code>"ENTREZID"</code>.</p>
<p>There is an additional line of code where I explicitly removed rows in <code>tb</code> where
an Entrez ID cannot be mapped to GO IDs.</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">keys</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/AnnotationDbi/man/AnnotationDb-class.html">keys</a></span><span class="op">(</span><span class="va">org</span>, keytype <span class="op">=</span> <span class="st">"ENTREZID"</span><span class="op">)</span></span>
<span><span class="va">tb</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/AnnotationDbi/man/AnnotationDb-class.html">select</a></span><span class="op">(</span><span class="va">org</span>, columns <span class="op">=</span> <span class="st">"GOALL"</span>, </span>
<span>    keys <span class="op">=</span> <span class="va">keys</span>, keytype <span class="op">=</span> <span class="st">"ENTREZID"</span><span class="op">)</span></span>
<span><span class="va">tb</span> <span class="op">=</span> <span class="va">tb</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">tb</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span><span class="op">)</span>, , drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">tb</span><span class="op">)</span></span>
<span><span class="co">#    ENTREZID      GOALL</span></span>
<span><span class="co"># 1 101315462 GO:0016668</span></span>
<span><span class="co"># 2 101315462 GO:0003674</span></span>
<span><span class="co"># 3 101315462 GO:0003824</span></span>
<span><span class="co"># 4 101315462 GO:0016491</span></span></code></pre></div>
<p>In the <code>org</code> object, we can see there is also a column <code>"ONTOLOGYALL"</code>. Together
with <code>"ONTOLOGYALL"</code>, we can also get the namespace of GO terms<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;Note &lt;code&gt;"ONTOLOGYALL"&lt;/code&gt;
should always be used with &lt;code&gt;"GOALL"&lt;/code&gt;. Quiz, without using the &lt;code&gt;"ONTOLOGYALL"&lt;/code&gt; column,
how do you get the ontology information by using &lt;code&gt;GOTERM&lt;/code&gt; and &lt;code&gt;Ontology()&lt;/code&gt;?&lt;/p&gt;'><sup>17</sup></a>.</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">keys</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/AnnotationDbi/man/AnnotationDb-class.html">keys</a></span><span class="op">(</span><span class="va">org</span>, keytype <span class="op">=</span> <span class="st">"ENTREZID"</span><span class="op">)</span></span>
<span><span class="va">tb</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/AnnotationDbi/man/AnnotationDb-class.html">select</a></span><span class="op">(</span><span class="va">org</span>, columns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"GOALL"</span>, <span class="st">"ONTOLOGYALL"</span><span class="op">)</span>,</span>
<span>    keys <span class="op">=</span> <span class="va">keys</span>, keytype <span class="op">=</span> <span class="st">"ENTREZID"</span><span class="op">)</span></span>
<span><span class="va">tb</span> <span class="op">=</span> <span class="va">tb</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">tb</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span><span class="op">)</span>, , drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">tb</span><span class="op">)</span></span>
<span><span class="co">#    ENTREZID      GOALL ONTOLOGYALL</span></span>
<span><span class="co"># 1 101315462 GO:0016668          MF</span></span>
<span><span class="co"># 2 101315462 GO:0003674          MF</span></span>
<span><span class="co"># 3 101315462 GO:0003824          MF</span></span>
<span><span class="co"># 4 101315462 GO:0016491          MF</span></span></code></pre></div>
<p>Now <code>tb</code> contains GO gene sets for dolphin.</p>
</div>
<div id="go-gene-sets-from-biomart" class="section level4" number="3.2.3.3">
<h4>
<span class="header-section-number">3.2.3.3</span> GO gene sets from BioMart<a class="anchor" aria-label="anchor" href="#go-gene-sets-from-biomart"><i class="fas fa-link"></i></a>
</h4>
<p>In the previous sections, GO gene sets are retrieved from <code>OrgDb</code> packages or
objects, where the annotation data is gathered from the NCBI database.
Ensembl, as one of the major databases for biology data, also provides data
for GO gene sets. Ensembl provides a web-based service called “BioMart”
(<a href="https://www.ensembl.org/info/data/biomart/index.html" class="uri">https://www.ensembl.org/info/data/biomart/index.html</a>) which has integrated a
huge amount of gene-level information. The companion Bioconductor package
<strong>biomaRt</strong> provides a programmatic interface to the BioMart web service.
BioMart contains gene-level information for a large number of verbarates.
Together with its sister databases: Ensembl Fungi, Ensembl Protists, Emsembl
Plants and Ensembl Metazoa, it provides a rich resource for GO gene sets.</p>
<p>In the following part of this section, I will first introduce how to retrieve
GO gene sets manually with the <strong>biomaRt</strong> package. then I will introduce the
<strong>BioMartGOGeneSets</strong> package which provides pre-compiled GO gene sets from
BioMart for hundrends of organisms.</p>
<p>Let’s load the <strong>biomaRt</strong> package.</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">biomaRt</span><span class="op">)</span></span></code></pre></div>
<p>First we need to create a “Mart” object which is like a connection to the
BioMart web service. Because this is a gene-related relation, we set argument
<code>biomart</code> to <code>"genes"</code><a class="footnote-ref" tabindex="0" data-toggle="popover" data-content="&lt;p&gt;BioMart also provides information for other genomic
entities such as SNPs.&lt;/p&gt;"><sup>18</sup></a>.</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ensembl</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/biomaRt/man/useEnsembl.html">useEnsembl</a></span><span class="op">(</span>biomart <span class="op">=</span> <span class="st">"genes"</span><span class="op">)</span></span></code></pre></div>
<p>Next we need to select an organism. In BioMart, an organism is called a
“dataset.” To get a proper value of an organism dataset, we use the function
<code><a href="https://rdrr.io/pkg/biomaRt/man/listDatasets.html">listDatasets()</a></code> to get the full list of supported datasets on BioMart.</p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">datasets</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/biomaRt/man/listDatasets.html">listDatasets</a></span><span class="op">(</span><span class="va">ensembl</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">datasets</span><span class="op">)</span></span>
<span><span class="co"># [1] 213   3</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">datasets</span><span class="op">)</span></span>
<span><span class="co">#                        dataset                           description</span></span>
<span><span class="co"># 1 abrachyrhynchus_gene_ensembl Pink-footed goose genes (ASM259213v1)</span></span>
<span><span class="co"># 2     acalliptera_gene_ensembl      Eastern happy genes (fAstCal1.2)</span></span>
<span><span class="co"># 3   acarolinensis_gene_ensembl       Green anole genes (AnoCar2.0v2)</span></span>
<span><span class="co"># 4    acchrysaetos_gene_ensembl       Golden eagle genes (bAquChr1.2)</span></span>
<span><span class="co">#       version</span></span>
<span><span class="co"># 1 ASM259213v1</span></span>
<span><span class="co"># 2  fAstCal1.2</span></span>
<span><span class="co"># 3 AnoCar2.0v2</span></span>
<span><span class="co"># 4  bAquChr1.2</span></span></code></pre></div>
<p>You can see there are quite a large number of organisms supported on BioMart.
The first column in the object <code>datasets</code> contains valid values for dataset
which will be used in later functions. Sometimes it is not easy to find the
correct dataset of your organism, especially when the organism is not a model
organism. The second column in <code>datasets</code> contains description of the
organism. We can search in these two columns.</p>
<p>In this example, I will try to use the dataset for giant panda (panda for short).
The valid dataset name can be found by searching “panda” in the “description” column
in <code>dataset</code>.</p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">datasets</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/grep.html">grep</a></span><span class="op">(</span><span class="st">"panda"</span>, <span class="va">datasets</span><span class="op">$</span><span class="va">description</span><span class="op">)</span>, , drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">]</span></span>
<span><span class="co">#                     dataset                     description     version</span></span>
<span><span class="co"># 6 amelanoleuca_gene_ensembl Giant panda genes (ASM200744v2) ASM200744v2</span></span></code></pre></div>
<p>Now we know the correct dataset name for panda is <code>"amelanoleuca_gene_ensembl"</code>.
Next, we set it to the <code>dataset</code> argument in the function <code>useDateset()</code>, which is
like adding a flag of which dataset to use.</p>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ensembl</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/biomaRt/man/useDataset.html">useDataset</a></span><span class="op">(</span>dataset <span class="op">=</span> <span class="st">"amelanoleuca_gene_ensembl"</span>, mart <span class="op">=</span> <span class="va">ensembl</span><span class="op">)</span></span></code></pre></div>
<p>The dataset is like a giant table with a huge number of columns which provide
massive additional information for genes. Here we are only interested in
GO-related information. In the dataset, the table columns are called
“attributes.” There are a huge number of supported attributes in a dataset.
The complete list of attributes can be obtained by the function
<code><a href="https://rdrr.io/pkg/biomaRt/man/listAttributes.html">listAttributes()</a></code>.</p>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">all_at</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/biomaRt/man/listAttributes.html">listAttributes</a></span><span class="op">(</span>mart <span class="op">=</span> <span class="va">ensembl</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">all_at</span><span class="op">)</span></span>
<span><span class="co"># [1] 2822    3</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">all_at</span><span class="op">)</span></span>
<span><span class="co">#                            name                  description         page</span></span>
<span><span class="co"># 1               ensembl_gene_id               Gene stable ID feature_page</span></span>
<span><span class="co"># 2       ensembl_gene_id_version       Gene stable ID version feature_page</span></span>
<span><span class="co"># 3         ensembl_transcript_id         Transcript stable ID feature_page</span></span>
<span><span class="co"># 4 ensembl_transcript_id_version Transcript stable ID version feature_page</span></span></code></pre></div>
<p>To get proper values for the attributes, we need to go through the long table
and sometimes this is not an easy task. The three attributes of GO-gene
relations are <code>c("ensembl_gene_id", "go_id", "namespace_1003")</code><a class="footnote-ref" tabindex="0" data-toggle="popover" data-content="&lt;p&gt;It takes me
several minutes to find out the namespace attributes.&lt;/p&gt;"><sup>19</sup></a>. Here we use
<code>ensembl_gene_id</code> as the gene ID because it is the primiary ID type for genes
on Ensembl database<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content="&lt;p&gt;The attribute for Entrez ID is “entrezgene_id.”&lt;/p&gt;"><sup>20</sup></a>.</p>
<p>Now everything is ready and we can use the
core function <code><a href="https://rdrr.io/pkg/biomaRt/man/getBM.html">getBM()</a></code> to obtain the GO-gene relation table.</p>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">at</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ensembl_gene_id"</span>, <span class="st">"go_id"</span>, <span class="st">"namespace_1003"</span><span class="op">)</span></span>
<span><span class="va">tb</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/biomaRt/man/getBM.html">getBM</a></span><span class="op">(</span>attributes <span class="op">=</span> <span class="va">at</span>, mart <span class="op">=</span> <span class="va">ensembl</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">tb</span><span class="op">)</span></span>
<span><span class="co">#      ensembl_gene_id      go_id     namespace_1003</span></span>
<span><span class="co"># 1 ENSAMEG00000005298 GO:0004930 molecular_function</span></span>
<span><span class="co"># 2 ENSAMEG00000005298 GO:0016021 cellular_component</span></span>
<span><span class="co"># 3 ENSAMEG00000005298 GO:0007186 biological_process</span></span>
<span><span class="co"># 4 ENSAMEG00000005298 GO:0004984 molecular_function</span></span></code></pre></div>
<p>Before we go further, let’s restrict the GO gene sets only in BP namespace,
and let’s split the data frame <code>tb</code> into a list of vector.</p>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tb</span> <span class="op">=</span> <span class="va">tb</span><span class="op">[</span><span class="va">tb</span><span class="op">$</span><span class="va">namespace_1003</span> <span class="op">==</span> <span class="st">"biological_process"</span>, , drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">]</span></span>
<span><span class="va">gs</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/split.html">split</a></span><span class="op">(</span><span class="va">tb</span><span class="op">$</span><span class="va">ensembl_gene_id</span>, <span class="va">tb</span><span class="op">$</span><span class="va">go_id</span><span class="op">)</span></span></code></pre></div>
<p>Is <code>gs</code> the final GO gene sets? Unfortunately the gene sets are not complete
in <code>gs</code>. As has been explained, GO has a tree structure where a parent term
includes all genes annotated to its child terms. For every GO terms in <code>gs</code>,
we need to merge genes from all its child or offspring terms to form a
complete gene set for this GO term.</p>
<p>As I have already explained, the hierarchical structure of GO terms is stored
in the <strong>GO.db</strong> package. In the following code, <code>bp_terms</code> contains a vector
of GO terms only in the BP namespace. The variable <code>GOBPOFFSPRING</code> is simply a
list where each element vector contains all offspring terms of a GO term.</p>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bp_terms</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/AnnotationDbi/man/GOColsAndKeytypes.html">GOID</a></span><span class="op">(</span><span class="va">GOTERM</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/Ontology.html">Ontology</a></span><span class="op">(</span><span class="va">GOTERM</span><span class="op">)</span> <span class="op">==</span> <span class="st">"BP"</span><span class="op">]</span></span>
<span><span class="va">GOBPOFFSPRING</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/as.list.html">as.list</a></span><span class="op">(</span><span class="va">GOBPOFFSPRING</span><span class="op">)</span></span></code></pre></div>
<p>Now it is quite easy to merge genes from offspring terms. Just note as the
final step, empty GO gene sets should be removed.</p>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gs2</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/lapply.html">lapply</a></span><span class="op">(</span><span class="va">bp_terms</span>, <span class="kw">function</span><span class="op">(</span><span class="va">nm</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">go_id</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">nm</span>, <span class="va">GOBPOFFSPRING</span><span class="op">[[</span><span class="va">nm</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="co"># self + offspring</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/unique.html">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/unlist.html">unlist</a></span><span class="op">(</span><span class="va">gs</span><span class="op">[</span><span class="va">go_id</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">gs2</span><span class="op">)</span> <span class="op">=</span> <span class="va">bp_terms</span></span>
<span><span class="va">gs2</span> <span class="op">=</span> <span class="va">gs2</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/lapply.html">sapply</a></span><span class="op">(</span><span class="va">gs2</span>, <span class="va">length</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">]</span></span></code></pre></div>
<p>As I have demonstrated in this section, manually retrieving GO gene sets from
BioMart and merging to the offspring terms is a long and complex process.
Since the data is retrieved from a web service, due to the limitation of
BioMart which limits the connection time to maximal 5 minutes, if you have low
internet connection, you are probabily not able to successfully get the
complete data, especially the GO-gene table is normally large.</p>
<p>To facilitate the use of BioMart GO gene sets, I have built a Bioconductor
package <strong>BioMartGOGeneSets</strong> which has already compiled GO gene sets for more
than 600 hundreds organisms. The GO gene sets can be easily obtained by a single
function:</p>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/jokergoo/BioMartGOGeneSets">BioMartGOGeneSets</a></span><span class="op">)</span></span>
<span><span class="va">gs</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/BioMartGOGeneSets/man/getBioMartGOGeneSets.html">getBioMartGOGeneSets</a></span><span class="op">(</span><span class="st">"amelanoleuca_gene_ensembl"</span>, ontology <span class="op">=</span> <span class="st">"BP"</span><span class="op">)</span></span></code></pre></div>
<p>The input of <code><a href="https://rdrr.io/pkg/BioMartGOGeneSets/man/getBioMartGOGeneSets.html">getBioMartGOGeneSets()</a></code> should be a valid name of BioMart
dataset name. Other query strings such as “human” or “panda” is also allowed.
It supports three gene ID types of Ensembl ID, Entrez ID or official gene
symbols. The full list of supported organisms and corresponding dataset names
can be found with the function <code><a href="https://rdrr.io/pkg/BioMartGOGeneSets/man/supportedOrganisms.html">supportedOrganisms()</a></code>.</p>
</div>
</div>
</div>
<div id="gene-set-format-in-r" class="section level2" number="3.3">
<h2>
<span class="header-section-number">3.3</span> Gene set format in R<a class="anchor" aria-label="anchor" href="#gene-set-format-in-r"><i class="fas fa-link"></i></a>
</h2>
<p>Before we continue to the next gene set database, now we can summarize the
general gene set formats in R, which we have already touched in previous
sections. In most analysis, a gene set is simply treated as a vector of genes.
Thus, naturally, a collection of gene sets can be represented as a list of
vectors. In the following example, I created two gene sets with 2 and 3 genes
respectively, where one gene is in both gene sets.</p>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gs1</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>    gene_set_1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"gene_1"</span>, <span class="st">"gene_2"</span><span class="op">)</span>, </span>
<span>    gene_set_2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"gene_1"</span>, <span class="st">"gene_3"</span>, <span class="st">"gene_4"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">gs1</span></span>
<span><span class="co"># $gene_set_1</span></span>
<span><span class="co"># [1] "gene_1" "gene_2"</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># $gene_set_2</span></span>
<span><span class="co"># [1] "gene_1" "gene_3" "gene_4"</span></span></code></pre></div>
<p>It is also very common to store the relations of gene sets and genes as a
two-column data frame, demonstrated in the following code. The order of gene
set column and gene column, i.e. which column locates as the first column, are
quite arbitrary. Different tools may require it differently, but they can be
very easily converted.</p>
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gs2</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>    gene_set <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"gene_set_1"</span>, <span class="st">"gene_set_1"</span>, <span class="st">"gene_set_2"</span>, <span class="st">"gene_set_2"</span>, <span class="st">"gene_set_2"</span><span class="op">)</span>,</span>
<span>    gene     <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"gene_1"</span>, <span class="st">"gene_2"</span>, <span class="st">"gene_1"</span>, <span class="st">"gene_3"</span>, <span class="st">"gene_4"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">gs2</span></span>
<span><span class="co">#     gene_set   gene</span></span>
<span><span class="co"># 1 gene_set_1 gene_1</span></span>
<span><span class="co"># 2 gene_set_1 gene_2</span></span>
<span><span class="co"># 3 gene_set_2 gene_1</span></span>
<span><span class="co"># 4 gene_set_2 gene_3</span></span>
<span><span class="co"># 5 gene_set_2 gene_4</span></span></code></pre></div>
<p>The two formats of the list and the data frame can be easily converted from
one to the other. From the list <code>gs1</code> to the data frame:</p>
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>gene_set <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">gs1</span>, times <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/lapply.html">sapply</a></span><span class="op">(</span><span class="va">gs1</span>, <span class="va">length</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>           gene <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/unlist.html">unlist</a></span><span class="op">(</span><span class="va">gs1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Or from the data frame <code>gs2</code> to the list, use the following code:</p>
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/split.html">split</a></span><span class="op">(</span><span class="va">gs2</span><span class="op">$</span><span class="va">gene</span>, <span class="va">gs2</span><span class="op">$</span><span class="va">gene_set</span><span class="op">)</span></span></code></pre></div>
<p>Not very often, gene sets are represented as a matrix where one dimension
corresponds to gene sets and the other dimension corresponds to genes. The
values in the matix are binary where a value of 1 represents the gene is a
member of the corresponding gene sets. In some methods, 1 is replaced by
<span class="math inline">\(w_{ij}\)</span> to weights the effect of the genes in the gene set.</p>
<pre><code>#            gene_1 gene_2 gene_3 gene_4
# gene_set_1      1      1      0      0
# gene_set_2      1      0      1      1</code></pre>
<p>For some specific gene set databases, there might be additional information
that will be used in gene set enrichment analysis. One typical case is the
pathway topology information is used in pathway enrichment analysis. We will
come to this topic in Chapter x.</p>
<p>In the following part of the book, we will use either the list or the data
frame to reprensent gene sets, depends on the specific scenarios.</p>
</div>
<div id="kegg-pathways" class="section level2" number="3.4">
<h2>
<span class="header-section-number">3.4</span> KEGG pathways<a class="anchor" aria-label="anchor" href="#kegg-pathways"><i class="fas fa-link"></i></a>
</h2>
<p>Kyoto Encyclopedia of Genes and Genomes (KEGG) is a comprehensive database of
genomic and molecular data for variaty of organisms, started from 1995. Its sub-database the
pathway database is a widely used gene set database used in current studies.
In KEGG, pathways are manually curated and the numbers of genes in pathways are
intermediate, which makes it easy to interprete. KEGG pathways are mainly related to metabolism,
but there are also many other types of pathways.</p>
<div class="inline-figure"><img src="02-database_files/figure-html/unnamed-chunk-66-1.png" width="672" style="display: block; margin: auto;"></div>
<p>Keep in mind, KEGG pathways are only free for academic users. If you use it for commercial purposes,
please contact the KEGG team to get a licence.</p>
<div id="kegg-api" class="section level3" number="3.4.1">
<h3>
<span class="header-section-number">3.4.1</span> KEGG API<a class="anchor" aria-label="anchor" href="#kegg-api"><i class="fas fa-link"></i></a>
</h3>
<p>KEGG provides its data via a REST API (<a href="https://rest.kegg.jp/" class="uri">https://rest.kegg.jp/</a>). There are
several commands that can be used to retrieve specific types of data. The URL form of the request is</p>
<pre><code>https://rest.kegg.jp/&lt;operation&gt;/&lt;argument&gt;[/&lt;argument2[/&lt;argument3&gt; ...]]</code></pre>
<p>To get the KEGG pathway gene sets, we will use the operations <code>link</code> and <code>list</code>.</p>
<p>The <code>link</code> operator returns the mapping between two sources of information. We can use
the following command to get the mappings between pathways and genes for human.</p>
<div class="sourceCode" id="cb64"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df1</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.table</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/connections.html">url</a></span><span class="op">(</span><span class="st">"https://rest.kegg.jp/link/pathway/hsa"</span><span class="op">)</span>, </span>
<span>    sep <span class="op">=</span> <span class="st">"\t"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">df1</span><span class="op">)</span></span>
<span><span class="co">#          V1            V2</span></span>
<span><span class="co"># 1 hsa:10327 path:hsa00010</span></span>
<span><span class="co"># 2   hsa:124 path:hsa00010</span></span>
<span><span class="co"># 3   hsa:125 path:hsa00010</span></span>
<span><span class="co"># 4   hsa:126 path:hsa00010</span></span></code></pre></div>
<p>In the example code, function <code><a href="https://rdrr.io/r/base/connections.html">url()</a></code> constructs a connection that directly
transfers data from the remote URL. In the request URL, <code>"hsa"</code> is the KEGG
organism code for human. In the output, the first column contains Entrez gene
IDs and the second column contains KEGG pathways IDs. The prefix <code>"hsa:"</code> and
<code>"path:"</code> should be removed for further analysis.</p>
<div class="sourceCode" id="cb65"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df1</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">"hsa:"</span>, <span class="st">""</span>, <span class="va">df1</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">df1</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">"path:"</span>,  <span class="st">""</span>, <span class="va">df1</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p>However, in <code>df1</code>, there are only pathway IDs for pathways, which is not human readable.
To get the full name of pathways, use the <code>list</code> operator.</p>
<div class="sourceCode" id="cb66"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df2</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.table</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/connections.html">url</a></span><span class="op">(</span><span class="st">"https://rest.kegg.jp/list/pathway/hsa"</span><span class="op">)</span>, </span>
<span>    sep <span class="op">=</span> <span class="st">"\t"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">df2</span><span class="op">)</span></span>
<span><span class="co">#         V1                                                     V2</span></span>
<span><span class="co"># 1 hsa01100              Metabolic pathways - Homo sapiens (human)</span></span>
<span><span class="co"># 2 hsa01200               Carbon metabolism - Homo sapiens (human)</span></span>
<span><span class="co"># 3 hsa01210 2-Oxocarboxylic acid metabolism - Homo sapiens (human)</span></span>
<span><span class="co"># 4 hsa01212           Fatty acid metabolism - Homo sapiens (human)</span></span></code></pre></div>
</div>
<div id="the-keggrest-package" class="section level3" number="3.4.2">
<h3>
<span class="header-section-number">3.4.2</span> The KEGGREST package<a class="anchor" aria-label="anchor" href="#the-keggrest-package"><i class="fas fa-link"></i></a>
</h3>
<p>There is a <strong>KEGGREST</strong> package which implements a full interface to access
KEGG data in R. All the APIs from KEGG REST service are suppoted in
<strong>KEGGREST</strong>. The names of functions in <strong>KEGGREST</strong> are consistent to the
operators in the KEGG API. For example, to get the mapping between genes and
pathways, the function <code><a href="https://rdrr.io/pkg/KEGGREST/man/keggLink.html">keggLink()</a></code> can be used.</p>
<div class="sourceCode" id="cb67"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">KEGGREST</span><span class="op">)</span></span>
<span><span class="va">gene2pathway</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/KEGGREST/man/keggLink.html">keggLink</a></span><span class="op">(</span><span class="st">"pathway"</span>, <span class="st">"hsa"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">gene2pathway</span><span class="op">)</span></span>
<span><span class="co">#       hsa:10327         hsa:124         hsa:125         hsa:126 </span></span>
<span><span class="co"># "path:hsa00010" "path:hsa00010" "path:hsa00010" "path:hsa00010"</span></span></code></pre></div>
<p>The returned object <code>gene2pathway</code> has a different format from the previous
data frame <code>df1</code>, which is now in a form of a named vector. In the vector,
names correspond to gene IDs and values correspond to pathway IDs. Readers can
try to execute <code>keggLink("hsa", "pathway")</code> to compare the results.</p>
<p>This named vectors are not common for downstream gene set analysis. A more
used format is a data frame. We can simply converted <code>gene2pathway</code> to a data frame.</p>
<div class="sourceCode" id="cb68"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df3</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span></span>
<span>    gene_id    <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">"hsa:"</span>, <span class="st">""</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">gene2pathway</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    pathway_id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">"path:"</span>, <span class="st">""</span>, <span class="va">gene2pathway</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">df2</span><span class="op">)</span></span>
<span><span class="co">#         V1                                                     V2</span></span>
<span><span class="co"># 1 hsa01100              Metabolic pathways - Homo sapiens (human)</span></span>
<span><span class="co"># 2 hsa01200               Carbon metabolism - Homo sapiens (human)</span></span>
<span><span class="co"># 3 hsa01210 2-Oxocarboxylic acid metabolism - Homo sapiens (human)</span></span>
<span><span class="co"># 4 hsa01212           Fatty acid metabolism - Homo sapiens (human)</span></span></code></pre></div>
<p>Similar as the list operator in KEGG API, <code><a href="https://rdrr.io/pkg/KEGGREST/man/keggList.html">keggList()</a></code> function can be used to retrieve
pathway IDs and their names. The function returns a named vector.</p>
<div class="sourceCode" id="cb69"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/KEGGREST/man/keggList.html">keggList</a></span><span class="op">(</span><span class="st">"pathway"</span>, <span class="st">"hsa"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#                                                 hsa01100 </span></span>
<span><span class="co">#              "Metabolic pathways - Homo sapiens (human)" </span></span>
<span><span class="co">#                                                 hsa01200 </span></span>
<span><span class="co">#               "Carbon metabolism - Homo sapiens (human)" </span></span>
<span><span class="co">#                                                 hsa01210 </span></span>
<span><span class="co"># "2-Oxocarboxylic acid metabolism - Homo sapiens (human)" </span></span>
<span><span class="co">#                                                 hsa01212 </span></span>
<span><span class="co">#           "Fatty acid metabolism - Homo sapiens (human)"</span></span></code></pre></div>
<p>KEGG database provides image representation of pathways, which is sometimes of
interest. The image for a specific pathway can be obtained by the function
<code><a href="https://rdrr.io/pkg/KEGGREST/man/keggGet.html">keggGet()</a></code>, by specifying the second argument <code>option</code> to <code>"image"</code>.</p>
<div class="sourceCode" id="cb70"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">image</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/KEGGREST/man/keggGet.html">keggGet</a></span><span class="op">(</span><span class="st">"hsa04911"</span>, option <span class="op">=</span> <span class="st">"image"</span><span class="op">)</span></span></code></pre></div>
<p>The returned object <code>image</code> is a matrix representation of RGB colors of pixels
of the image. To save the image object into an image file, we need to use the <strong>png</strong>
package.</p>
<div class="sourceCode" id="cb71"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://www.rforge.net/png/">png</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/png/man/writePNG.html">writePNG</a></span><span class="op">(</span><span class="va">image</span>, <span class="st">"hsa04911.png"</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="hsa04911.png" width="590" style="display: block; margin: auto;"></div>
<p>In a second use case, readers may want to highlight some genes in the path way
image, e.g. to highlight differentially expressed genes. The function
<code><a href="https://rdrr.io/pkg/KEGGREST/man/mark.pathway.by.objects.html">color.pathway.by.objects()</a></code> in <strong>KEGGREST</strong> accepts a vector of genes and
assigns them with a set of colors. In the following example, I randomly picked
10 genes from the pathway <code>"hsa04911"</code>.</p>
<p>Being different from <code>keggGet(..., option = "image")</code>,
<code><a href="https://rdrr.io/pkg/KEGGREST/man/mark.pathway.by.objects.html">color.pathway.by.objects()</a></code> does not directly returns an image object. KEGG
supports generating a colored KEGG image on the server side by specifying a
customized set of parameters provided in a URL. And the colored KEGG image is
available in a temporary URL. What <code><a href="https://rdrr.io/pkg/KEGGREST/man/mark.pathway.by.objects.html">color.pathway.by.objects()</a></code> does is it
first formats and sends the request URL to KEGG, and retrieves the temporary
URL back from KEGG.</p>
<div class="sourceCode" id="cb72"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">genes</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">gene2pathway</span><span class="op">[</span><span class="va">gene2pathway</span> <span class="op">==</span> <span class="st">"path:hsa04911"</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">diff_genes</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/AnnotationDbi/man/Bimap-envirAPI.html">sample</a></span><span class="op">(</span><span class="va">genes</span>, <span class="fl">10</span><span class="op">)</span></span>
<span><span class="va">url</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/KEGGREST/man/mark.pathway.by.objects.html">color.pathway.by.objects</a></span><span class="op">(</span><span class="st">"path:hsa04911"</span>,</span>
<span>    object.id.list <span class="op">=</span> <span class="va">diff_genes</span>, </span>
<span>    fg.color.list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"blue"</span>, <span class="fl">10</span><span class="op">)</span>, </span>
<span>    bg.color.list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="st">"orange"</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">url</span></span>
<span><span class="co"># [1] "https://www.kegg.jp/tmp/mark_pathway1680120249116960/hsa04911.png"</span></span></code></pre></div>
<p>Then we need to manually download the image.</p>
<div class="sourceCode" id="cb73"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/download.file.html">download.file</a></span><span class="op">(</span><span class="va">url</span>, destfile <span class="op">=</span> <span class="st">"hsa04911_colored.png"</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="hsa04911_colored.png" width="590" style="display: block; margin: auto;"></div>
<p>KEGG supports a huge amount of organisms. The complete list of all organisms
can be obtained with the <code><a href="https://rdrr.io/pkg/KEGGREST/man/keggList.html">keggList()</a></code> function by specifying the argument to
<code>"organism"</code>.</p>
<div class="sourceCode" id="cb74"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">all_organisms</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/KEGGREST/man/keggList.html">keggList</a></span><span class="op">(</span><span class="st">"organism"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">all_organisms</span><span class="op">)</span></span>
<span><span class="co">#      T.number organism species                                            </span></span>
<span><span class="co"># [1,] "T01001" "hsa"    "Homo sapiens (human)"                             </span></span>
<span><span class="co"># [2,] "T01005" "ptr"    "Pan troglodytes (chimpanzee)"                     </span></span>
<span><span class="co"># [3,] "T02283" "pps"    "Pan paniscus (bonobo)"                            </span></span>
<span><span class="co"># [4,] "T02442" "ggo"    "Gorilla gorilla gorilla (western lowland gorilla)"</span></span>
<span><span class="co">#      phylogeny                               </span></span>
<span><span class="co"># [1,] "Eukaryotes;Animals;Vertebrates;Mammals"</span></span>
<span><span class="co"># [2,] "Eukaryotes;Animals;Vertebrates;Mammals"</span></span>
<span><span class="co"># [3,] "Eukaryotes;Animals;Vertebrates;Mammals"</span></span>
<span><span class="co"># [4,] "Eukaryotes;Animals;Vertebrates;Mammals"</span></span></code></pre></div>
<p>The second column contains organism code which can be used in <code><a href="https://rdrr.io/pkg/KEGGREST/man/keggLink.html">keggLink()</a></code> to
get the pathway gene sets. For example, to search for the organism code for
panda, we can try to search “panda” in the <code>"species"</code> column. Note here we
also set <code>ignore.case = TRUE</code> to let the search case insensitive.</p>
<div class="sourceCode" id="cb75"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># note `all_oragnisms` is a matrix, not a data frame</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/grep.html">grep</a></span><span class="op">(</span><span class="st">"panda"</span>, <span class="va">all_organisms</span><span class="op">[</span>, <span class="st">"species"</span><span class="op">]</span>, ignore.case <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co"># [1] 59</span></span></code></pre></div>
<p>We find the organism code for panda is <code>"aml"</code> and we can use it to retrieve
the corresponding pathway data.</p>
<div class="sourceCode" id="cb76"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">all_organisms</span><span class="op">[</span><span class="fl">59</span>, <span class="op">]</span></span>
<span><span class="co">#                                 T.number </span></span>
<span><span class="co">#                                 "T01329" </span></span>
<span><span class="co">#                                 organism </span></span>
<span><span class="co">#                                    "aml" </span></span>
<span><span class="co">#                                  species </span></span>
<span><span class="co">#   "Ailuropoda melanoleuca (giant panda)" </span></span>
<span><span class="co">#                                phylogeny </span></span>
<span><span class="co"># "Eukaryotes;Animals;Vertebrates;Mammals"</span></span></code></pre></div>
</div>
</div>
<div id="the-msigdb-database" class="section level2" number="3.5">
<h2>
<span class="header-section-number">3.5</span> The MSigDB database<a class="anchor" aria-label="anchor" href="#the-msigdb-database"><i class="fas fa-link"></i></a>
</h2>
<p>Molecular signature database (MSigDB,
<a href="https://www.gsea-msigdb.org/gsea/msigdb/" class="uri">https://www.gsea-msigdb.org/gsea/msigdb/</a>) is a mauanlly curated gene set
database. Initially, it was proposed as a supplementary dataset for the
original GSEA paper. Later it has been separated out and developed
independently. In the first version in 2005, there were only two gene set
collections and in total 843 gene sets. Now in the newest version of MSigDB
(v2023.1.Hs), it has grown into nine gene set collections, covering in total
33591 gene sets. It provides gene sets on a variety of topics.</p>
<p>MSigDB defines a general data format for gene sets, which is called the “gmt”
format. The gmt format is a plain text-based format, where each row correspond
to one gene set. In each row, elements are separated by tabs. The first
element is the unique ID for the gene set, and the second element is a full
description of the corresponding gene set. If the description is not
available, empty string can also be used. From the third element to the end of
the line there are genes in the gene set. An example content of the gmt format
file is as follows:</p>
<pre><code>gene_set_1  gene_set_description_1    gene_1   gene_2
gene_set_2  gene_set_description_2    gene_1   gene_3   gene_4
... other lines</code></pre>
<p>To read the gmt file is straightforward. We first read the gmt file by lines,
then split each line by tabs, finally remove the first two elements in each
line. The following four lines of code reads a gmt file and save the gene sets
as a list of vectors. The file <code>h.all.v2023.1.Hs.entrez.gmt</code> corresponds to
the hallmark gene sets in MSigDb which we will introduce later.</p>
<div class="sourceCode" id="cb78"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ln</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/readLines.html">readLines</a></span><span class="op">(</span><span class="st">"data/h.all.v2023.1.Hs.entrez.gmt"</span><span class="op">)</span></span>
<span><span class="va">ln</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/strsplit.html">strsplit</a></span><span class="op">(</span><span class="va">ln</span>, <span class="st">"\t"</span><span class="op">)</span></span>
<span><span class="co"># remove the first two elements which are gene set name and description</span></span>
<span><span class="va">gs</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/lapply.html">lapply</a></span><span class="op">(</span><span class="va">ln</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">[</span><span class="op">-</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co"># The first element in each line is the gene set name</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">gs</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/lapply.html">sapply</a></span><span class="op">(</span><span class="va">ln</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p>MSigDB categorizes gene sets into nine collections where each collection
focuses on a specific topic. For some collections, they are additionally split
into sub-collections. The complete list of MSigDB collection is in the following table.</p>
<pre><code>h hallmark gene sets
c1 positional gene sets
c2 curated gene sets
c2:CGP chemical and genetic pertubations
c2:CP canonical pathways
C2:CP BioCarte BioCarte pathways
C2:CP:KEGG KEGG pathways
C2:CP:PID PID pathways
C2:CP:Reactome Reactome pathways
C2:CP:WikiPahtways WikiPathways
C3 regulatory target gene sets
C3:MIR microRNA targets
C3:MIR:miRDB 
C3:MIR:MIR_legancy
C3:TFT
C3:TFT:GTRD
C3:TFT:TFT legacy
C4
C4:CGN
C4:CM
C5
C5:GO
C5:GO:BP
C5:GO:CC
C5:GO:MF
C5:HPO
C6
C7
C7:ImmuneSigDB
C7:VAX
C8</code></pre>
<p>MSigDB provides a gmt file for each collection as well as its sub-collections.
Readers can use the previously mentioned four lines of code to read the gmt
files and import it in R.</p>
<p>Among the nine gene set collections, the hallmark gene sets are especially useful.</p>
<p>MSigDB provides gene set data for human. From 2022, MSigDB also provides gene sets for mouse. However,
there are only 6 gene set collections with in total 16063 gene sets.</p>
<p>Having MSigDB gene sets into R is rather simple. I also implemeted several
“helper” functions which facilitate readers to read the specific gene sets
from specific versions. MSigDB has been envolving, it provides data for
different versions. <code>list_msigdb_versions()</code> gives the current versions and
history versions. Note it includes versions for both human and mouse. The
newest version for human is <code>"2023.1.Hs</code> and the newest version for mouse is
<code>"2023.1.Mm"</code>.</p>
<div class="sourceCode" id="cb80"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">list_msigdb_versions</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#  [1] "6.0"       "6.1"       "6.2"       "7.0"       "7.1"       "7.2"      </span></span>
<span><span class="co">#  [7] "7.3"       "7.4"       "7.5.1"     "7.5"       "2022.1.Hs" "2022.1.Mm"</span></span>
<span><span class="co"># [13] "2023.1.Hs" "2023.1.Mm"</span></span></code></pre></div>
<p>Next by selecting a specific version, we can see the list of gene set collections. In <code>list_msigdb_collections()</code>
the value of version should be provided.</p>
<div class="sourceCode" id="cb81"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">list_msigdb_collections</span><span class="op">(</span><span class="st">"2023.1.Hs"</span><span class="op">)</span></span>
<span><span class="co">#  [1] "c1.all"             "c2.all"             "c2.cgp"            </span></span>
<span><span class="co">#  [4] "c2.cp.biocarta"     "c2.cp.kegg"         "c2.cp.pid"         </span></span>
<span><span class="co">#  [7] "c2.cp.reactome"     "c2.cp"              "c2.cp.wikipathways"</span></span>
<span><span class="co"># [10] "c3.all"             "c3.mir.mir_legacy"  "c3.mir.mirdb"      </span></span>
<span><span class="co"># [13] "c3.mir"             "c3.tft.gtrd"        "c3.tft.tft_legacy" </span></span>
<span><span class="co"># [16] "c3.tft"             "c4.all"             "c4.cgn"            </span></span>
<span><span class="co"># [19] "c4.cm"              "c5.all"             "c5.go.bp"          </span></span>
<span><span class="co"># [22] "c5.go.cc"           "c5.go.mf"           "c5.go"             </span></span>
<span><span class="co"># [25] "c5.hpo"             "c6.all"             "c7.all"            </span></span>
<span><span class="co"># [28] "c7.immunesigdb"     "c7.vax"             "c8.all"            </span></span>
<span><span class="co"># [31] "h.all"</span></span>
<span><span class="fu">list_msigdb_collections</span><span class="op">(</span><span class="st">"2023.1.Mm"</span><span class="op">)</span></span>
<span><span class="co">#  [1] "m1.all"             "m2.all"             "m2.cgp"            </span></span>
<span><span class="co">#  [4] "m2.cp.biocarta"     "m2.cp.reactome"     "m2.cp"             </span></span>
<span><span class="co">#  [7] "m2.cp.wikipathways" "m3.all"             "m3.gtrd"           </span></span>
<span><span class="co"># [10] "m3.mirdb"           "m5.all"             "m5.go.bp"          </span></span>
<span><span class="co"># [13] "m5.go.cc"           "m5.go.mf"           "m5.go"             </span></span>
<span><span class="co"># [16] "m5.mpt"             "m8.all"             "mh.all"</span></span></code></pre></div>
<p>With a speicfic version and a specific collection name, we can get the gene sets from MSigDB.</p>
<div class="sourceCode" id="cb82"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lt</span> <span class="op">=</span> <span class="fu">get_msigdb</span><span class="op">(</span>version <span class="op">=</span> <span class="st">"2023.1.Hs"</span>, collection <span class="op">=</span> <span class="st">"h.all"</span><span class="op">)</span></span></code></pre></div>
<p>If <code>as_table</code> is set to <code>TRUE</code>, <code>get_msigdb()</code> returns a data frame.</p>
<div class="sourceCode" id="cb83"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span> <span class="op">=</span> <span class="fu">get_msigdb</span><span class="op">(</span>version <span class="op">=</span> <span class="st">"2023.1.Hs"</span>, collection <span class="op">=</span> <span class="st">"h.all"</span>, as_table <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>If no argument is provided for <code>get_msigdb()</code>, the function allows to interactively select the versions
and collections.</p>
</div>
<div id="reactome-pathways" class="section level2" number="3.6">
<h2>
<span class="header-section-number">3.6</span> Reactome pathways<a class="anchor" aria-label="anchor" href="#reactome-pathways"><i class="fas fa-link"></i></a>
</h2>
<p>Reactome is another popular pathway database. It organizes pathways in an
hierarchical way, which contains pathways and sub pathways or pathway
components. There is a <strong>reactome.db</strong> on Bioconductor. Similar as other
annotation packages, there are also pre-compiled objects in the package.
The two important objects related to gene sets are:</p>
<ul>
<li>
<code>reactomePATHID2EXTID</code> contains mappings between reacotme pathway IDs and
gene Entrez IDs.</li>
<li>
<code>reactomePATHID2NAME</code> contains pathway names.</li>
</ul>
<p>The two objects are generated by <strong>AnnotationDbi</strong>, so we use the function
<code><a href="https://rdrr.io/pkg/BiocGenerics/man/toTable.html">toTable()</a></code> to retrieve the data as data frames. We can also apply <code><a href="https://rdrr.io/r/base/list.html">as.list()</a></code>
to convert the two objects into lists. Readers may try <code><a href="https://rdrr.io/r/base/list.html">as.list()</a></code> on the two
objects and compare the output by themselves.</p>
<div class="sourceCode" id="cb84"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">reactome.db</span><span class="op">)</span></span>
<span><span class="va">tb</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/toTable.html">toTable</a></span><span class="op">(</span><span class="va">reactomePATHID2EXTID</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">tb</span><span class="op">)</span></span>
<span><span class="co">#          DB_ID gene_id</span></span>
<span><span class="co"># 1 R-HSA-109582       1</span></span>
<span><span class="co"># 2 R-HSA-114608       1</span></span>
<span><span class="co"># 3 R-HSA-168249       1</span></span>
<span><span class="co"># 4 R-HSA-168256       1</span></span>
<span><span class="va">p2n</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/toTable.html">toTable</a></span><span class="op">(</span><span class="va">reactomePATHID2NAME</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">p2n</span><span class="op">)</span></span>
<span><span class="co">#           DB_ID</span></span>
<span><span class="co"># 1   R-BTA-73843</span></span>
<span><span class="co"># 2 R-BTA-1971475</span></span>
<span><span class="co"># 3 R-BTA-1369062</span></span>
<span><span class="co"># 4  R-BTA-382556</span></span>
<span><span class="co">#                                                                     path_name</span></span>
<span><span class="co"># 1                                              1-diphosphate: 5-Phosphoribose</span></span>
<span><span class="co"># 2 Bos taurus: A tetrasaccharide linker sequence is required for GAG synthesis</span></span>
<span><span class="co"># 3                           Bos taurus: ABC transporters in lipid homeostasis</span></span>
<span><span class="co"># 4                          Bos taurus: ABC-family proteins mediated transport</span></span></code></pre></div>
<p>Organism information is encoded in the pathway IDs in the second section of
the ID string. E.g. in previous output, the code <code>"BTA"</code> corresponds to cattle
(Latin name “Bos taurus”). We can check numbers of pathways for all supported
organisms.</p>
<div class="sourceCode" id="cb85"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/table.html">table</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/substr.html">substr</a></span><span class="op">(</span><span class="va">p2n</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>, <span class="fl">3</span>, <span class="fl">5</span><span class="op">)</span> <span class="op">)</span></span>
<span><span class="co"># </span></span>
<span><span class="co">#  BTA  CEL  CFA  DDI  DME  DRE  GGA  HSA  MMU  MTU  PFA  RNO  SCE  SPO  SSC  XTR </span></span>
<span><span class="co"># 1696 1304 1657  982 1477 1676 1706 2601 1715   13  599 1702  812  819 1660 1580</span></span></code></pre></div>
</div>
<div id="uniprot-keywords" class="section level2" number="3.7">
<h2>
<span class="header-section-number">3.7</span> UniProt keywords<a class="anchor" aria-label="anchor" href="#uniprot-keywords"><i class="fas fa-link"></i></a>
</h2>
<p>The UniProt database provides a controlled vocabulary to describe gene
functions, called the “UniProt Keywords”
(<a href="https://www.uniprot.org/help/keywords" class="uri">https://www.uniprot.org/help/keywords</a>). Being different from Gene Ontology,
the gene descriptions from UniProt Keywords are short and compact, which
provides an easy and fast way to explore the data. The UniProt Keywords are
classified into 10 categories:</p>
<ul>
<li>Biological process, e.g. Cell cycle.</li>
<li>Cellular component, e.g. Transmembrane.</li>
<li>Coding sequence diversity, e.g. Alternative splicing.</li>
<li>Developmental stage, e.g. Heterocyst.</li>
<li>Disease, e.g. Alzheimer disease.</li>
<li>Domain, e.g. Zinc-finger.</li>
<li>Ligand, e.g. GTP-binding.</li>
<li>Molecular function, e.g. Kinase.</li>
<li>Post-translational modification, e.g. Methylation.</li>
<li>Technical term, e.g. Genetically modified food.</li>
</ul>
<p>Like Gene Ontology, the keywords are also organized in a hierarchical way. I
have built a package <strong>UniProtKeywords</strong> which includes keywords gene sets for
26 organisms). To get the gene sets, use the function
<code><a href="https://rdrr.io/pkg/UniProtKeywords/man/load_keyword_genesets.html">load_keyword_genesets()</a></code> by providing the corresponding taxon ID of the
organism. The taxon ID is the primary ID from NCBI taxon database. You may
need to search from there to find out the taxon ID of your organism. The gene
ID in the gene sets is always Entrez ID.</p>
<div class="sourceCode" id="cb86"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/jokergoo/UniProtKeywords">UniProtKeywords</a></span><span class="op">)</span></span>
<span><span class="va">gl</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/UniProtKeywords/man/load_keyword_genesets.html">load_keyword_genesets</a></span><span class="op">(</span><span class="fl">9606</span><span class="op">)</span></span>
<span><span class="va">gl</span><span class="op">[</span><span class="fl">7</span><span class="op">:</span><span class="fl">8</span><span class="op">]</span></span>
<span><span class="co"># $`ATP synthesis`</span></span>
<span><span class="co"># [1] "514" "498" "506" "513" "509"</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># $`ATP-binding`</span></span>
<span><span class="co">#   [1] "9716"   "23132"  "10973"  "546"    "641"    "9044"   "9557"   "1105"  </span></span>
<span><span class="co">#   [9] "1106"   "1107"   "1108"   "26038"  "84181"  "55636"  "57680"  "80205" </span></span>
<span><span class="co">#  [17] "55308"  "11269"  "1662"   "1663"   "10521"  "8886"   "1653"   "11218" </span></span>
<span><span class="co">#  [25] "9188"   "9416"   "57062"  "29118"  "55661"  "55794"  "64794"  "1654"  </span></span>
<span><span class="co">#  [33] "8653"   "51428"  "11325"  "55510"  "9879"   "51202"  "54555"  "54514" </span></span>
<span><span class="co">#  [41] "79009"  "317781" "11056"  "168400" "79039"  "57696"  "54606"  "23586" </span></span>
<span><span class="co">#  [49] "83479"  "1655"   "55601"  "91351"  "1656"   "1665"   "8449"   "54505" </span></span>
<span><span class="co">#  [57] "22907"  "55760"  "56919"  "9704"   "60625"  "170506" "57647"  "79665" </span></span>
<span><span class="co">#  [65] "90957"  "79132"  "1659"   "1660"   "23405"  "1763"   "165545" "10212" </span></span>
<span><span class="co">#  [73] "7919"   "57634"  "375748" "54821"  "2068"   "2071"   "2074"   "83990" </span></span>
<span><span class="co">#  [81] "57697"  "84893"  "10146"  "92797"  "3070"   "113510" "85441"  "9931"  </span></span>
<span><span class="co">#  [89] "164045" "6596"   "1973"   "1974"   "9775"   "64135"  "54456"  "4171"  </span></span>
<span><span class="co">#  [97] "4172"   "4173"   "4174"   "4175"   "4176"   "84515"  "254394" "4343"  </span></span>
<span><span class="co"># [105] "23517"  "89797"  "56652"  "80119"  "9785"   "25788"  "8438"   "5965"  </span></span>
<span><span class="co"># [113] "9401"   "9400"   "5976"   "51750"  "8607"   "10856"  "23064"  "257218"</span></span>
<span><span class="co"># [121] "6499"   "91607"  "50485"  "3508"   "6594"   "6595"   "6597"   "8467"  </span></span>
<span><span class="co"># [129] "56916"  "10847"  "6832"   "91646"  "122402" "8458"   "23020"  "7486"  </span></span>
<span><span class="co"># [137] "7520"   "2547"   "64848"  "84083"</span></span></code></pre></div>
<p>To make it easy to use, the first argument in <code><a href="https://rdrr.io/pkg/UniProtKeywords/man/load_keyword_genesets.html">load_keyword_genesets()</a></code> can
also be an organism’s Latin name or common name. Categories can be set with
the <code>category</code> argument and argument <code>as_table</code> controls whether to return the
gene sets in a list or in a two-column data frame.</p>
<p>We can check the number of characters:</p>
<div class="sourceCode" id="cb87"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/table.html">table</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nchar.html">nchar</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">gl</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, </span>
<span>    xlab <span class="op">=</span> <span class="st">"Number of characters in keywords"</span>,</span>
<span>    ylab <span class="op">=</span> <span class="st">"Number of keywords"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="02-database_files/figure-html/unnamed-chunk-90-1.png" width="672" style="display: block; margin: auto;"></div>
<p>We can see most of the keyword names are short, which might facilitate to get
a quick overview of the data.</p>
</div>
<div id="gene-id-mapping" class="section level2" number="3.8">
<h2>
<span class="header-section-number">3.8</span> Gene ID mapping<a class="anchor" aria-label="anchor" href="#gene-id-mapping"><i class="fas fa-link"></i></a>
</h2>
<p>To perform gene set enrichment analysis, there are always two types of data.
The first one is the genes. In the over-representation analysis which will be
introduced in Chapter x, it is represented as a vector of genes; and in the gene
set enrichment anlaysis introduced in Chapter x, genes are represented as row names of the
expression matrix. The second one is the gene sets. The gene ID types in the two
data sources may not be the same since they may come from different sources.
Thus it is a common task to convert gene ID to make them consistent.</p>
<p>In the old days when microarray was the major technology for high-throughput
gene expression profiling, there are a large number of microarray platforms
and each one has its own probe ID sets, which makes it difficult to find the
correct platform and to convert probe IDs to more standard gene IDs. From the last decade,
technology has been envolved to high-throughput sequencing, where the analysis replies
on gene annotations from public databases, such as Ensembl or NCBI. This makes
the use of gene ID types in a more standard way. The following
four genes ID types are very commonly used:</p>
<ul>
<li>Entrez IDs. The primary gene ID in NCBI gene database. The IDs are represented as a list of digits.</li>
<li>Ensembl IDs. The primary gene ID in Ensembl gene database. The Ensembl ID consists of five parts: <code>ENS(species)(object type)(identifier).(version).</code>.
Taking an ID <code>ENSG00000075336</code> as an example, <code>ENS</code> identifies the ID is from Ensembl database, <code>G</code> tells it is an ID for genes. The following digits are
the idenfitier. An Ensemble ID is normally with an version number, e.g. <code>ENSG00000075336.1</code>, but sometimes it is ommited. For non-human organisms,
a species code in also available in the ID, e.g. <code>ENSMUSG00000017167.6</code>.</li>
<li>Gene Symbols. Human readable code for genes, such as “TP53.” This is normally used in papers.</li>
<li>RefSeq IDs. The primary ID in RefSeq database. But not it is</li>
</ul>
<p>Thanks to the Bioconductor annotation ecosystem, the <strong>org.*.eg.db</strong> packages provide annotation sources of genes
from various databases, take <strong>org.Hs.eg.db</strong> package as an example, we first check all the “columns” supported.</p>
<div class="sourceCode" id="cb88"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/AnnotationDbi/man/AnnotationDb-class.html">keytypes</a></span><span class="op">(</span><span class="va">org.Hs.eg.db</span><span class="op">)</span></span>
<span><span class="co">#  [1] "ACCNUM"       "ALIAS"        "ENSEMBL"      "ENSEMBLPROT"  "ENSEMBLTRANS"</span></span>
<span><span class="co">#  [6] "ENTREZID"     "ENZYME"       "EVIDENCE"     "EVIDENCEALL"  "GENENAME"    </span></span>
<span><span class="co"># [11] "GENETYPE"     "GO"           "GOALL"        "IPI"          "MAP"         </span></span>
<span><span class="co"># [16] "OMIM"         "ONTOLOGY"     "ONTOLOGYALL"  "PATH"         "PFAM"        </span></span>
<span><span class="co"># [21] "PMID"         "PROSITE"      "REFSEQ"       "SYMBOL"       "UCSCKG"      </span></span>
<span><span class="co"># [26] "UNIPROT"</span></span></code></pre></div>
<p>The columns for genes are <code>ENSEMBL</code>, <code>ENREZID</code>, <code>REFSEQ</code> and <code>SYMBOL</code>. We use the <code><a href="https://rdrr.io/pkg/AnnotationDbi/man/AnnotationDb-class.html">select()</a></code> interface to obtain the mapping
from one ID type to the other. E.g. to convert from Entrez ID to Ensembl.</p>
<div class="sourceCode" id="cb89"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">entrez_gene</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"80325"</span>, <span class="st">"9662"</span>, <span class="st">"29090"</span>, <span class="st">"4678"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/AnnotationDbi/man/AnnotationDb-class.html">select</a></span><span class="op">(</span><span class="va">org.Hs.eg.db</span>, keys <span class="op">=</span> <span class="va">entrez_gene</span>, columns <span class="op">=</span> <span class="st">"ENSEMBL"</span>, keytype <span class="op">=</span> <span class="st">"ENTREZID"</span><span class="op">)</span></span>
<span><span class="co">#   ENTREZID         ENSEMBL</span></span>
<span><span class="co"># 1    80325 ENSG00000114626</span></span>
<span><span class="co"># 2     9662 ENSG00000174799</span></span>
<span><span class="co"># 3    29090 ENSG00000075336</span></span>
<span><span class="co"># 4     4678 ENSG00000132780</span></span></code></pre></div>
<p>BioMart also provides rich information on gene-levels, thus, we can also use
the <strong>biomart</strong> package to convert gene IDs. The following code demonstrates
how to get the mapping between Entrez ID and Ensembl ID for a selected four
genes. In this example, in <code><a href="https://rdrr.io/pkg/biomaRt/man/getBM.html">getBM()</a></code>, since we already have a subset of genes,
we specify the ID type with the <code>filters</code> argument (like the <code>keytype</code> in
<code><a href="https://rdrr.io/pkg/AnnotationDbi/man/AnnotationDb-class.html">select()</a></code>) and we provide the gene vector (like the <code>keys</code> in <code><a href="https://rdrr.io/pkg/AnnotationDbi/man/AnnotationDb-class.html">select()</a></code>).</p>
<div class="sourceCode" id="cb90"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ensembl</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/biomaRt/man/useEnsembl.html">useEnsembl</a></span><span class="op">(</span>biomart <span class="op">=</span> <span class="st">"genes"</span><span class="op">)</span></span>
<span><span class="va">ensembl</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/biomaRt/man/useDataset.html">useDataset</a></span><span class="op">(</span>dataset <span class="op">=</span> <span class="st">"hsapiens_gene_ensembl"</span>, mart <span class="op">=</span> <span class="va">ensembl</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/biomaRt/man/getBM.html">getBM</a></span><span class="op">(</span>attributes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"entrezgene_id"</span>, <span class="st">"ensembl_gene_id"</span><span class="op">)</span>, mart <span class="op">=</span> <span class="va">ensembl</span>, </span>
<span>    filters <span class="op">=</span> <span class="st">"entrezgene_id"</span>, values <span class="op">=</span> <span class="va">entrez_gene</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#   entrezgene_id ensembl_gene_id</span></span>
<span><span class="co"># 1         29090 ENSG00000075336</span></span>
<span><span class="co"># 2          4678 ENSG00000132780</span></span>
<span><span class="co"># 3         80325 ENSG00000114626</span></span>
<span><span class="co"># 4          9662 ENSG00000174799</span></span></code></pre></div>
</div>
<div id="generate-gene-sets-for-other-organisms-by-mapping-to-orthologues" class="section level2" number="3.9">
<h2>
<span class="header-section-number">3.9</span> Generate gene sets for other organisms by mapping to orthologues<a class="anchor" aria-label="anchor" href="#generate-gene-sets-for-other-organisms-by-mapping-to-orthologues"><i class="fas fa-link"></i></a>
</h2>
<p>In the Bioconductor ecosystem, there are already a huge number of gene set
resources for a large number of organisms. However, there can still be cases
where a poor-studied organism does not have a well-annotated gene set
resource. Human, of course, is the most studied organism and it has the richest
annotation resources. For other organisms, we can built similar gene sets by
mapping to orthologues to human genes.</p>
<p>The hallmark gene sets is a useful resource for exploring the biological
functions. But natively, MSigDB only provides data for human and mouse, but
still a large number of other organisms are missing. In the following part of
this section, I will demonstrate how to construct hallmark gene sets for
panda.</p>
<p>Let me first demonstrate how to obtain the mapping from human genes to panda
genes. In Biocoductor, there is a standard package <strong>Orthology.eg.db</strong> which
provides orthologue mappings for hundreds of organisms. Let’s first load the
package.</p>
<div class="sourceCode" id="cb91"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">Orthology.eg.db</span><span class="op">)</span></span></code></pre></div>
<p>Similarly, there is a database object <code>Orthology.eg.db</code> which has the same
name as the package.</p>
<div class="sourceCode" id="cb92"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Orthology.eg.db</span></span>
<span><span class="co"># OrthologyDb object:</span></span>
<span><span class="co"># | Db type: OrthologyDb</span></span>
<span><span class="co"># | Supporting package: AnnotationDbi</span></span>
<span><span class="co"># | DBSCHEMA: ORTHOLOGY_DB</span></span>
<span><span class="co"># | EGSOURCEDATE: 2022-Sep12</span></span>
<span><span class="co"># | EGSOURCENAME: Entrez Gene</span></span>
<span><span class="co"># | EGSOURCEURL: ftp://ftp.ncbi.nlm.nih.gov/gene/DATA</span></span>
<span><span class="co"># | DBSCHEMAVERSION: 2.1</span></span></code></pre></div>
<p>The orthology database can be thought as a table where columns are different
organisms, and rows are groups of orthologues genes. All supported organisms
can be obtained by the function <code><a href="https://rdrr.io/pkg/AnnotationDbi/man/AnnotationDb-class.html">columns()</a></code>.</p>
<div class="sourceCode" id="cb93"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cl</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/AnnotationDbi/man/AnnotationDb-class.html">columns</a></span><span class="op">(</span><span class="va">Orthology.eg.db</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">cl</span><span class="op">)</span></span>
<span><span class="co"># [1] 473</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">cl</span><span class="op">)</span></span>
<span><span class="co"># [1] "Acanthisitta.chloris"        "Acanthochromis.polyacanthus"</span></span>
<span><span class="co"># [3] "Acanthopagrus.latus"         "Accipiter.gentilis"</span></span></code></pre></div>
<p>The column names correspond to organism’s Latin names, separated by a dot
character. Remember to use the <code><a href="https://rdrr.io/pkg/AnnotationDbi/man/AnnotationDb-class.html">select()</a></code> interface, we also need to check
which column can be used for the keys. In <code>Orthology.eg.db</code>, all columns can
be used as key columns, which means, we can map between any two organisms We
can valiadte it by:</p>
<div class="sourceCode" id="cb94"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">kt</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/AnnotationDbi/man/AnnotationDb-class.html">keytypes</a></span><span class="op">(</span><span class="va">Orthology.eg.db</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/identical.html">identical</a></span><span class="op">(</span><span class="va">cl</span>, <span class="va">kt</span><span class="op">)</span></span>
<span><span class="co"># [1] TRUE</span></span></code></pre></div>
<p>We check whether the panda organism is supported in <strong>Orthology.eg.db</strong> by
searching its Latin name “Ailuropoda melanoleuca.”</p>
<div class="sourceCode" id="cb95"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">kt</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/grep.html">grep</a></span><span class="op">(</span><span class="st">"Ailuropoda"</span>, <span class="va">kt</span>, ignore.case <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="co"># [1] "Ailuropoda.melanoleuca"</span></span></code></pre></div>
<p>Yes, it is supported. For converting between two types of IDs, I will first
create a global mapping vector, where human genes are the names of the vector
and panda genes are the values.</p>
<p>I first extract all the human genes, which will be the primary keys for the
orthology mapping. Remember the value for <code>keytype</code> argument should be a valid
value in <code>keytypes(Orthology.eg.db)</code>.</p>
<div class="sourceCode" id="cb96"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">keys</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/AnnotationDbi/man/AnnotationDb-class.html">keys</a></span><span class="op">(</span><span class="va">Orthology.eg.db</span>, keytype <span class="op">=</span> <span class="st">"Homo.sapiens"</span><span class="op">)</span></span></code></pre></div>
<p>Now we can apply <code><a href="https://rdrr.io/pkg/AnnotationDbi/man/AnnotationDb-class.html">select()</a></code> function on the <code>Orthology.eg.db</code> database object and generate the mapping.</p>
<div class="sourceCode" id="cb97"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">map_df</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/AnnotationDbi/man/AnnotationDb-class.html">select</a></span><span class="op">(</span><span class="va">Orthology.eg.db</span>, <span class="va">keys</span>, </span>
<span>    columns <span class="op">=</span> <span class="st">"Ailuropoda.melanoleuca"</span>, keytype <span class="op">=</span> <span class="st">"Homo.sapiens"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">map_df</span><span class="op">)</span></span>
<span><span class="co">#   Homo.sapiens Ailuropoda.melanoleuca</span></span>
<span><span class="co"># 1            1              100482878</span></span>
<span><span class="co"># 2            2                     NA</span></span>
<span><span class="co"># 3            9                     NA</span></span>
<span><span class="co"># 4           10                     NA</span></span></code></pre></div>
<p>Now <code>map_df</code> is a two-column data frame where the first column includes the
genes for human and the second column includes genes for panda. If there is no
orthologue mapping, the corresponding value for panda is <code>NA</code>. We see the gene IDs
are integers, but what is exactly the ID type of it? We have to go through the documentation
of the <strong>Orthology.eg.db</strong> package, it tells the internal IDs are Entrez IDs.</p>
<p>Before we move on, we have to double check how Entrez IDs are saved in <code>map_df</code>.</p>
<div class="sourceCode" id="cb98"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">map_df</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co"># [1] "integer"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">map_df</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co"># [1] "integer"</span></span></code></pre></div>
<p>Unfortunately they are in integer mode, we have to convert them to characters.</p>
<div class="sourceCode" id="cb99"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">map_df</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">map_df</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">map_df</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">map_df</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p>Now we can safely constrcut the mapping vector where human genes are names and
panda genes are values.</p>
<div class="sourceCode" id="cb100"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">map_vec</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/structure.html">structure</a></span><span class="op">(</span><span class="va">map_df</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span>, names <span class="op">=</span> <span class="va">map_df</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co"># or we can do it in two lines</span></span>
<span><span class="va">map_vec</span> <span class="op">=</span> <span class="va">map_df</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">map_vec</span><span class="op">)</span> <span class="op">=</span> <span class="va">map_df</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span></span></code></pre></div>
<p>We have the mappings from human to panda, now we can construct the hallmark
gene sets for panda. First let’s obtain the hallmark gene sets for human. The
<code>get_msigdb()</code> function is from the <strong>GSEAbook</strong> package.</p>
<div class="sourceCode" id="cb101"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gs_human</span> <span class="op">=</span> <span class="fu">get_msigdb</span><span class="op">(</span>version <span class="op">=</span> <span class="st">"2023.1.Hs"</span>, collection <span class="op">=</span> <span class="st">"h.all"</span><span class="op">)</span></span></code></pre></div>
<p>Next we perform the conversion by providing the human genes are character
indicies. Note if the human gene is not mapped to panda gene, the
corresponding value will be <code>NA</code>, which we need to remove it. Using the
<code><a href="https://rdrr.io/r/base/unname.html">unname()</a></code> function is optional. The reason is <code>x2</code> is constructed from
<code>map_vec</code> which has names attached. Here I removed the name attributes of <code>x2</code>
to make <code>gs_panda</code> easy to read.</p>
<div class="sourceCode" id="cb102"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gs_panda</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/lapply.html">lapply</a></span><span class="op">(</span><span class="va">gs_human</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">x2</span> <span class="op">=</span> <span class="va">map_vec</span><span class="op">[</span><span class="va">x</span><span class="op">]</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/unname.html">unname</a></span><span class="op">(</span><span class="va">x2</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">x2</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>And finally to remove empty gene sets. Now <code>gs_panda</code> contains hallmark gene
sets for panda.</p>
<div class="sourceCode" id="cb103"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gs_panda</span> <span class="op">=</span> <span class="va">gs_panda</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/pkg/BiocGenerics/man/lapply.html">sapply</a></span><span class="op">(</span><span class="va">gs_panda</span>, <span class="va">length</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">]</span></span></code></pre></div>
</div>
<div id="summary" class="section level2" number="3.10">
<h2>
<span class="header-section-number">3.10</span> Summary<a class="anchor" aria-label="anchor" href="#summary"><i class="fas fa-link"></i></a>
</h2>
<p>In this chapter, I introduced several widely used gene set databases. Bioconductor
provides a rich resource of gene sets, together with outer cloud and API to external databases,
additionally with mapping to orthologue genes.</p>

</div>
</div>

  <div class="chapter-nav">
<div class="empty"></div>
<div class="empty"></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <div id="book-on-this-page"></div>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Gene Set Enrichment Analysis with R and Bioconductor</strong>" was written by Zuguang Gu. It was last built on 2022-11-26.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
